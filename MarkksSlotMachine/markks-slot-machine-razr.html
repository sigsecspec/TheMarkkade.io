<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markk's Professional Slot Machine - Motorola Razr Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            font-family: 'Arial Black', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            overflow: hidden;
            height: 100vh;
            color: #fff;
        }

        /* Dual Screen Layout for Motorola Razr 2024 */
        .razr-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        /* Top Screen - Display Area */
        .top-screen {
            height: 50vh;
            width: 100%;
            background: linear-gradient(145deg, #2c3e50, #34495e);
            border-bottom: 3px solid #f39c12;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        /* Bottom Screen - Controls */
        .bottom-screen {
            height: 50vh;
            width: 100%;
            background: linear-gradient(145deg, #1a252f, #2c3e50);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Slot Machine Frame */
        .slot-frame {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            height: calc(100% - 20px);
            background: linear-gradient(145deg, #8b4513, #a0522d);
            border-radius: 15px;
            border: 4px solid #ffd700;
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        /* Game Title */
        .game-title {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                0 0 10px #ffd700,
                2px 2px 4px rgba(0, 0, 0, 0.8);
            animation: titleGlow 2s ease-in-out infinite alternate;
            z-index: 10;
        }

        @keyframes titleGlow {
            from { text-shadow: 0 0 10px #ffd700, 2px 2px 4px rgba(0, 0, 0, 0.8); }
            to { text-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700, 2px 2px 4px rgba(0, 0, 0, 0.8); }
        }

        /* Reels Container */
        .reels-container {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            height: 60%;
            background: linear-gradient(145deg, #000, #1a1a1a);
            border: 3px solid #ffd700;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            padding: 10px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        /* Individual Reel */
        .reel {
            width: 30%;
            height: 100%;
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            border: 2px solid #666;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .reel-strip {
            position: absolute;
            width: 100%;
            transition: transform 0.1s ease-out;
        }

        .symbol {
            width: 100%;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-bottom: 1px solid #666;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Payline Indicator */
        .payline {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ff0000, #ff0000, transparent);
            transform: translateY(-50%);
            z-index: 5;
            opacity: 0;
            animation: paylineBlink 1s ease-in-out infinite;
        }

        @keyframes paylineBlink {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* Credits and Bet Display */
        .info-display {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            height: 80px;
            background: linear-gradient(145deg, #1a1a1a, #2c2c2c);
            border: 2px solid #ffd700;
            border-radius: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .info-item {
            text-align: center;
            padding: 5px;
        }

        .info-label {
            font-size: 0.8rem;
            color: #ccc;
            display: block;
        }

        .info-value {
            font-size: 1.4rem;
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }

        /* Control Panel */
        .control-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px;
        }

        /* Button Row */
        .button-row {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        /* Game Buttons */
        .game-button {
            flex: 1;
            height: 60px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                0 6px 0 #333,
                0 8px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .game-button:active {
            transform: translateY(3px);
            box-shadow: 
                0 3px 0 #333,
                0 5px 10px rgba(0, 0, 0, 0.3);
        }

        .spin-button {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            color: white;
            font-size: 1.2rem;
            height: 80px;
            border-radius: 20px;
            box-shadow: 
                0 8px 0 #a93226,
                0 12px 20px rgba(0, 0, 0, 0.4);
        }

        .spin-button:active {
            transform: translateY(4px);
            box-shadow: 
                0 4px 0 #a93226,
                0 8px 15px rgba(0, 0, 0, 0.4);
        }

        .bet-button {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
        }

        .max-bet-button {
            background: linear-gradient(145deg, #f39c12, #e67e22);
            color: white;
        }

        .cash-out-button {
            background: linear-gradient(145deg, #27ae60, #229954);
            color: white;
        }

        /* Particle Effects */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }

        .coin-particle {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ffd700, #ffed4e);
            border-radius: 50%;
            border: 2px solid #f1c40f;
        }

        .sparkle-particle {
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px #fff;
        }

        /* Win Animation */
        .win-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 215, 0, 0.1);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .win-text {
            font-size: 3rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                0 0 20px #ffd700,
                0 0 40px #ffd700;
            animation: winPulse 1s ease-in-out infinite;
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Jackpot Animation */
        .jackpot-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            animation: jackpotFlash 0.5s ease-in-out infinite;
        }

        @keyframes jackpotFlash {
            0%, 100% { background: rgba(255, 0, 0, 0.8); }
            50% { background: rgba(255, 215, 0, 0.8); }
        }

        .jackpot-text {
            font-size: 4rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 
                0 0 30px #fff,
                0 0 60px #ffd700;
            animation: jackpotBounce 1s ease-in-out infinite;
        }

        @keyframes jackpotBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-5deg); }
            75% { transform: scale(1.2) rotate(5deg); }
        }

        /* Touch Ripple Effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: rippleEffect 0.6s linear;
            pointer-events: none;
        }

        @keyframes rippleEffect {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Spinning Animation */
        .spinning {
            animation: spin 0.1s linear infinite;
        }

        @keyframes spin {
            from { transform: translateY(0); }
            to { transform: translateY(-80px); }
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .game-title {
                font-size: 1.4rem;
            }
            
            .symbol {
                font-size: 2.5rem;
                height: 70px;
            }
            
            .info-value {
                font-size: 1.2rem;
            }
            
            .game-button {
                font-size: 0.9rem;
                height: 50px;
            }
            
            .spin-button {
                height: 70px;
                font-size: 1.1rem;
            }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-logo {
            font-size: 3rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            margin-bottom: 30px;
            animation: logoFloat 2s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .loading-bar {
            width: 300px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #ffd700;
        }

        .loading-text {
            color: #ccc;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">🎰 MARKK'S CASINO 🎰</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="loading-text" id="loadingText">Loading Professional Slot Machine...</div>
    </div>

    <!-- Main Game Container -->
    <div class="razr-container" id="gameContainer" style="display: none;">
        <!-- Top Screen - Display Area -->
        <div class="top-screen" id="topScreen">
            <div class="slot-frame">
                <div class="game-title">🎰 MARKK'S ROYAL SLOTS 🎰</div>
                
                <div class="reels-container">
                    <div class="reel" id="reel1">
                        <div class="reel-strip" id="strip1"></div>
                    </div>
                    <div class="reel" id="reel2">
                        <div class="reel-strip" id="strip2"></div>
                    </div>
                    <div class="reel" id="reel3">
                        <div class="reel-strip" id="strip3"></div>
                    </div>
                    <div class="payline" id="payline"></div>
                </div>

                <div class="info-display">
                    <div class="info-item">
                        <span class="info-label">CREDITS</span>
                        <span class="info-value" id="credits">1000</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">BET</span>
                        <span class="info-value" id="currentBet">10</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">WIN</span>
                        <span class="info-value" id="lastWin">0</span>
                    </div>
                    <div class="info-item" id="bonusInfo" style="display: none;">
                        <span class="info-label">BONUS</span>
                        <span class="info-value" id="bonusText">-</span>
                    </div>
                </div>
            </div>

            <!-- Win Overlay -->
            <div class="win-overlay" id="winOverlay">
                <div class="win-text" id="winText">BIG WIN!</div>
            </div>
        </div>

        <!-- Bottom Screen - Controls -->
        <div class="bottom-screen">
            <div class="control-panel">
                <div class="button-row">
                    <button class="game-button bet-button" id="betButton">
                        💰 BET<br><span style="font-size: 0.8rem;">Change Bet</span>
                    </button>
                    <button class="game-button max-bet-button" id="maxBetButton">
                        🔥 MAX BET<br><span style="font-size: 0.8rem;">Maximum Bet</span>
                    </button>
                    <button class="game-button cash-out-button" id="cashOutButton">
                        💸 CASH OUT<br><span style="font-size: 0.8rem;">Collect Winnings</span>
                    </button>
                </div>
                
                <button class="game-button spin-button" id="spinButton">
                    🎰 SPIN TO WIN! 🎰
                </button>
                
                <div class="button-row">
                    <button class="game-button bet-button" id="autoSpinButton">
                        🔄 AUTO SPIN<br><span style="font-size: 0.8rem;">Automatic Play</span>
                    </button>
                    <button class="game-button bet-button" id="payTableButton">
                        📊 PAY TABLE<br><span style="font-size: 0.8rem;">View Payouts</span>
                    </button>
                    <button class="game-button bet-button" id="settingsButton">
                        ⚙️ SETTINGS<br><span style="font-size: 0.8rem;">Game Options</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Jackpot Overlay -->
    <div class="jackpot-overlay" id="jackpotOverlay">
        <div class="jackpot-text">🎉 JACKPOT! 🎉</div>
    </div>

    <script>
        class ProfessionalSlotMachine {
            constructor() {
                this.credits = 1000;
                this.currentBet = 10;
                this.betLevels = [5, 10, 25, 50, 100, 250];
                this.betIndex = 1;
                this.lastWin = 0;
                this.isSpinning = false;
                this.autoSpinActive = false;
                this.autoSpinCount = 0;
                this.bonusRoundActive = false;
                this.freeSpinsRemaining = 0;
                this.multiplier = 1;
                this.totalWinnings = 0;
                this.gamesPlayed = 0;
                
                // Slot symbols with weights (higher weight = more common)
                this.symbols = [
                    { symbol: '🍒', weight: 30, payout: { 2: 2, 3: 10 } },
                    { symbol: '🍋', weight: 25, payout: { 2: 3, 3: 15 } },
                    { symbol: '🍊', weight: 20, payout: { 2: 4, 3: 20 } },
                    { symbol: '🍇', weight: 15, payout: { 2: 5, 3: 25 } },
                    { symbol: '🔔', weight: 10, payout: { 2: 8, 3: 40 } },
                    { symbol: '⭐', weight: 8, payout: { 2: 10, 3: 60 } },
                    { symbol: '💎', weight: 5, payout: { 2: 15, 3: 100 } },
                    { symbol: '👑', weight: 3, payout: { 2: 25, 3: 200 } },
                    { symbol: '🎰', weight: 2, payout: { 2: 50, 3: 500 } },
                    { symbol: '💰', weight: 1, payout: { 2: 100, 3: 1000 } },
                    { symbol: '🎁', weight: 1, payout: { 2: 0, 3: 0 }, special: 'bonus' },
                    { symbol: '🆓', weight: 1, payout: { 2: 0, 3: 0 }, special: 'freespin' }
                ];
                
                this.reelSymbols = this.generateReelSymbols();
                this.audioContext = null;
                this.sounds = {};
                
                this.init();
            }

            async init() {
                await this.loadGame();
                this.setupEventListeners();
                this.setupAudio();
                this.createReelStrips();
                this.updateDisplay();
                this.hideLoadingScreen();
            }

            async loadGame() {
                const loadingProgress = document.getElementById('loadingProgress');
                const loadingText = document.getElementById('loadingText');
                
                const loadingSteps = [
                    'Initializing casino systems...',
                    'Loading slot machine mechanics...',
                    'Setting up audio systems...',
                    'Configuring haptic feedback...',
                    'Preparing visual effects...',
                    'Calibrating random number generator...',
                    'Loading symbol library...',
                    'Finalizing game setup...'
                ];
                
                for (let i = 0; i < loadingSteps.length; i++) {
                    loadingText.textContent = loadingSteps[i];
                    loadingProgress.style.width = `${((i + 1) / loadingSteps.length) * 100}%`;
                    await this.delay(300 + Math.random() * 200);
                }
            }

            hideLoadingScreen() {
                const loadingScreen = document.getElementById('loadingScreen');
                const gameContainer = document.getElementById('gameContainer');
                
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    loadingScreen.style.transition = 'opacity 0.5s ease';
                    
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        gameContainer.style.display = 'flex';
                        gameContainer.style.opacity = '0';
                        gameContainer.style.transition = 'opacity 0.5s ease';
                        
                        setTimeout(() => {
                            gameContainer.style.opacity = '1';
                        }, 50);
                    }, 500);
                }, 1000);
            }

            generateReelSymbols() {
                const weightedSymbols = [];
                this.symbols.forEach(symbolData => {
                    for (let i = 0; i < symbolData.weight; i++) {
                        weightedSymbols.push(symbolData.symbol);
                    }
                });
                
                // Create longer reel strips for more realistic spinning
                const reelLength = 20;
                return [
                    this.shuffleArray([...weightedSymbols]).slice(0, reelLength),
                    this.shuffleArray([...weightedSymbols]).slice(0, reelLength),
                    this.shuffleArray([...weightedSymbols]).slice(0, reelLength)
                ];
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            createReelStrips() {
                for (let reelIndex = 0; reelIndex < 3; reelIndex++) {
                    const strip = document.getElementById(`strip${reelIndex + 1}`);
                    strip.innerHTML = '';
                    
                    // Create multiple copies for seamless scrolling
                    for (let copy = 0; copy < 4; copy++) {
                        this.reelSymbols[reelIndex].forEach(symbol => {
                            const symbolDiv = document.createElement('div');
                            symbolDiv.className = 'symbol';
                            symbolDiv.textContent = symbol;
                            strip.appendChild(symbolDiv);
                        });
                    }
                }
            }

            setupEventListeners() {
                // Spin button
                document.getElementById('spinButton').addEventListener('click', () => {
                    if (!this.isSpinning) {
                        this.spin();
                    }
                });

                // Bet button
                document.getElementById('betButton').addEventListener('click', () => {
                    this.changeBet();
                });

                // Max bet button
                document.getElementById('maxBetButton').addEventListener('click', () => {
                    this.maxBet();
                });

                // Cash out button
                document.getElementById('cashOutButton').addEventListener('click', () => {
                    this.cashOut();
                });

                // Auto spin button
                document.getElementById('autoSpinButton').addEventListener('click', () => {
                    this.toggleAutoSpin();
                });

                // Pay table button
                document.getElementById('payTableButton').addEventListener('click', () => {
                    this.showPayTable();
                });

                // Settings button
                document.getElementById('settingsButton').addEventListener('click', () => {
                    this.showSettings();
                });

                // Top screen touch effects
                document.getElementById('topScreen').addEventListener('click', (e) => {
                    this.createTouchRipple(e);
                    this.createSparkleEffect(e);
                    this.vibrate([50, 30, 50]);
                });

                // Button touch effects
                document.querySelectorAll('.game-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        this.createButtonRipple(e);
                        this.vibrate([80]);
                    });
                });
            }

            setupAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.createSounds();
                } catch (error) {
                    console.log('Audio not supported');
                }
            }

            createSounds() {
                // Create various sound effects using Web Audio API
                this.sounds = {
                    spin: this.createTone(220, 0.1, 'sawtooth'),
                    win: this.createTone(440, 0.3, 'sine'),
                    bigWin: this.createTone(880, 0.5, 'sine'),
                    jackpot: this.createTone(1760, 1.0, 'sine'),
                    button: this.createTone(330, 0.05, 'square'),
                    reel: this.createTone(110, 0.02, 'sawtooth')
                };
            }

            createTone(frequency, duration, type = 'sine') {
                return () => {
                    if (!this.audioContext) return;
                    
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    oscillator.type = type;
                    
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                };
            }

            vibrate(pattern) {
                if (navigator.vibrate) {
                    navigator.vibrate(pattern);
                }
            }

            createTouchRipple(event) {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                
                const rect = event.currentTarget.getBoundingClientRect();
                const size = 60;
                const x = event.clientX - rect.left - size / 2;
                const y = event.clientY - rect.top - size / 2;
                
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                
                event.currentTarget.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            }

            createButtonRipple(event) {
                const button = event.currentTarget;
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                
                const rect = button.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = event.clientX - rect.left - size / 2;
                const y = event.clientY - rect.top - size / 2;
                
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.style.background = 'rgba(255, 255, 255, 0.3)';
                
                button.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            }

            createSparkleEffect(event) {
                const sparkleCount = 5;
                const rect = event.currentTarget.getBoundingClientRect();
                
                for (let i = 0; i < sparkleCount; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'particle sparkle-particle';
                    
                    const x = event.clientX - rect.left + (Math.random() - 0.5) * 100;
                    const y = event.clientY - rect.top + (Math.random() - 0.5) * 100;
                    
                    sparkle.style.left = x + 'px';
                    sparkle.style.top = y + 'px';
                    
                    event.currentTarget.appendChild(sparkle);
                    
                    // Animate sparkle
                    sparkle.animate([
                        { transform: 'scale(0) rotate(0deg)', opacity: 1 },
                        { transform: 'scale(1) rotate(180deg)', opacity: 1, offset: 0.5 },
                        { transform: 'scale(0) rotate(360deg)', opacity: 0 }
                    ], {
                        duration: 800,
                        easing: 'ease-out'
                    }).onfinish = () => sparkle.remove();
                }
            }

            createCoinEffect(winAmount) {
                const coinCount = Math.min(winAmount / 10, 20);
                const topScreen = document.getElementById('topScreen');
                
                for (let i = 0; i < coinCount; i++) {
                    setTimeout(() => {
                        const coin = document.createElement('div');
                        coin.className = 'particle coin-particle';
                        
                        const startX = Math.random() * topScreen.offsetWidth;
                        const startY = topScreen.offsetHeight * 0.3;
                        
                        coin.style.left = startX + 'px';
                        coin.style.top = startY + 'px';
                        
                        topScreen.appendChild(coin);
                        
                        // Animate coin falling
                        coin.animate([
                            { 
                                transform: 'translateY(0) rotate(0deg) scale(0)',
                                opacity: 1
                            },
                            { 
                                transform: `translateY(${topScreen.offsetHeight * 0.6}px) rotate(720deg) scale(1)`,
                                opacity: 1,
                                offset: 0.8
                            },
                            { 
                                transform: `translateY(${topScreen.offsetHeight * 0.7}px) rotate(900deg) scale(0)`,
                                opacity: 0
                            }
                        ], {
                            duration: 1500 + Math.random() * 500,
                            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                        }).onfinish = () => coin.remove();
                    }, i * 100);
                }
            }

            async spin() {
                if (this.isSpinning || this.credits < this.currentBet) {
                    if (this.credits < this.currentBet) {
                        this.showMessage('Insufficient credits!');
                        this.vibrate([200, 100, 200]);
                    }
                    return;
                }

                this.isSpinning = true;
                this.credits -= this.currentBet;
                this.lastWin = 0;
                this.updateDisplay();

                // Play spin sound
                if (this.sounds.spin) this.sounds.spin();
                
                // Vibrate for spin start
                this.vibrate([100, 50, 100]);

                // Hide any existing win overlay
                document.getElementById('winOverlay').style.display = 'none';

                // Start reel spinning animations
                const spinDurations = [2000, 2500, 3000]; // Different durations for each reel
                const results = [];

                for (let i = 0; i < 3; i++) {
                    const strip = document.getElementById(`strip${i + 1}`);
                    strip.classList.add('spinning');
                    
                    // Play reel sound
                    if (this.sounds.reel) {
                        const reelSoundInterval = setInterval(() => {
                            if (this.sounds.reel) this.sounds.reel();
                        }, 100);
                        
                        setTimeout(() => {
                            clearInterval(reelSoundInterval);
                        }, spinDurations[i]);
                    }
                }

                // Stop reels one by one
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const strip = document.getElementById(`strip${i + 1}`);
                        strip.classList.remove('spinning');
                        
                        // Get random result
                        const result = this.getRandomSymbol();
                        results.push(result);
                        
                        // Position reel to show result
                        this.positionReel(i, result);
                        
                        // Vibrate when reel stops
                        this.vibrate([150]);
                        
                        // Check for win after all reels stop
                        if (i === 2) {
                            setTimeout(() => {
                                this.checkWin(results);
                                this.isSpinning = false;
                                
                                // Continue auto spin if active
                                if (this.autoSpinActive && this.autoSpinCount > 0) {
                                    this.autoSpinCount--;
                                    if (this.autoSpinCount > 0) {
                                        setTimeout(() => this.spin(), 1000);
                                    } else {
                                        this.autoSpinActive = false;
                                        document.getElementById('autoSpinButton').textContent = '🔄 AUTO SPIN\nAutomatic Play';
                                    }
                                }
                            }, 500);
                        }
                    }, spinDurations[i]);
                }
            }

            getRandomSymbol() {
                const totalWeight = this.symbols.reduce((sum, symbol) => sum + symbol.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const symbolData of this.symbols) {
                    random -= symbolData.weight;
                    if (random <= 0) {
                        return symbolData.symbol;
                    }
                }
                
                return this.symbols[0].symbol; // Fallback
            }

            positionReel(reelIndex, symbol) {
                const strip = document.getElementById(`strip${reelIndex + 1}`);
                const symbols = strip.querySelectorAll('.symbol');
                
                // Find a symbol that matches our result
                let targetIndex = -1;
                for (let i = 0; i < symbols.length; i++) {
                    if (symbols[i].textContent === symbol) {
                        targetIndex = i;
                        break;
                    }
                }
                
                if (targetIndex !== -1) {
                    // Position so the symbol appears in the center viewing window
                    const symbolHeight = 80;
                    const offset = -(targetIndex * symbolHeight) + symbolHeight;
                    strip.style.transform = `translateY(${offset}px)`;
                }
            }

            checkWin(results) {
                const symbolCounts = {};
                results.forEach(symbol => {
                    symbolCounts[symbol] = (symbolCounts[symbol] || 0) + 1;
                });

                let winAmount = 0;
                let winType = '';
                let specialFeature = null;

                // Check for special features first
                if (symbolCounts['🎁'] >= 3) {
                    specialFeature = 'bonus';
                } else if (symbolCounts['🆓'] >= 3) {
                    specialFeature = 'freespin';
                }

                // Check for regular matches
                for (const [symbol, count] of Object.entries(symbolCounts)) {
                    const symbolData = this.symbols.find(s => s.symbol === symbol);
                    if (symbolData && symbolData.payout[count]) {
                        const basePayout = symbolData.payout[count] * this.currentBet;
                        const payout = basePayout * this.multiplier;
                        winAmount += payout;
                        
                        if (count === 3) {
                            winType = symbol === '💰' ? 'JACKPOT' : 
                                     payout >= 100 ? 'BIG WIN' : 'WIN';
                        } else if (count === 2) {
                            winType = winType || 'SMALL WIN';
                        }
                    }
                }

                // Handle special features
                if (specialFeature === 'bonus') {
                    this.triggerBonusRound();
                } else if (specialFeature === 'freespin') {
                    this.triggerFreeSpins();
                }

                if (winAmount > 0) {
                    this.lastWin = winAmount;
                    this.credits += winAmount;
                    this.totalWinnings += winAmount;
                    this.showWin(winType, winAmount);
                    this.updateDisplay();
                    
                    // Show payline
                    document.getElementById('payline').style.opacity = '1';
                    setTimeout(() => {
                        document.getElementById('payline').style.opacity = '0';
                    }, 2000);
                } else {
                    this.updateDisplay();
                }

                this.gamesPlayed++;
                
                // Handle free spins
                if (this.freeSpinsRemaining > 0) {
                    this.freeSpinsRemaining--;
                    this.updateBonusDisplay();
                    
                    if (this.freeSpinsRemaining === 0) {
                        this.multiplier = 1;
                        this.hideBonusDisplay();
                        this.showMessage('Free spins completed!');
                    }
                }
            }

            triggerBonusRound() {
                this.bonusRoundActive = true;
                this.showMessage('🎁 BONUS ROUND TRIGGERED! 🎁\nPick a treasure chest!');
                this.vibrate([200, 100, 200, 100, 200]);
                
                // Simple bonus round - instant win
                const bonusWin = this.currentBet * (10 + Math.floor(Math.random() * 40));
                setTimeout(() => {
                    this.credits += bonusWin;
                    this.totalWinnings += bonusWin;
                    this.showMessage(`🎁 Bonus Win: $${bonusWin}! 🎁`);
                    this.updateDisplay();
                    this.bonusRoundActive = false;
                }, 2000);
            }

            triggerFreeSpins() {
                this.freeSpinsRemaining = 5 + Math.floor(Math.random() * 6); // 5-10 free spins
                this.multiplier = 2 + Math.floor(Math.random() * 3); // 2x-4x multiplier
                this.showBonusDisplay();
                this.showMessage(`🆓 FREE SPINS! 🆓\n${this.freeSpinsRemaining} spins with ${this.multiplier}x multiplier!`);
                this.vibrate([150, 50, 150, 50, 150, 50, 150]);
            }

            showBonusDisplay() {
                const bonusInfo = document.getElementById('bonusInfo');
                bonusInfo.style.display = 'block';
                this.updateBonusDisplay();
            }

            hideBonusDisplay() {
                const bonusInfo = document.getElementById('bonusInfo');
                bonusInfo.style.display = 'none';
            }

            updateBonusDisplay() {
                const bonusText = document.getElementById('bonusText');
                if (this.freeSpinsRemaining > 0) {
                    bonusText.textContent = `${this.freeSpinsRemaining}x${this.multiplier}`;
                } else {
                    bonusText.textContent = '-';
                }
            }

            showWin(winType, amount) {
                const winOverlay = document.getElementById('winOverlay');
                const winText = document.getElementById('winText');
                
                if (winType === 'JACKPOT') {
                    // Show jackpot overlay
                    const jackpotOverlay = document.getElementById('jackpotOverlay');
                    jackpotOverlay.style.display = 'flex';
                    
                    if (this.sounds.jackpot) this.sounds.jackpot();
                    this.vibrate([200, 100, 200, 100, 200, 100, 200]);
                    
                    setTimeout(() => {
                        jackpotOverlay.style.display = 'none';
                    }, 3000);
                } else if (winType === 'BIG WIN') {
                    winText.textContent = `🎉 ${winType}! 🎉\n$${amount}`;
                    winOverlay.style.display = 'flex';
                    
                    if (this.sounds.bigWin) this.sounds.bigWin();
                    this.vibrate([150, 50, 150, 50, 150]);
                    
                    setTimeout(() => {
                        winOverlay.style.display = 'none';
                    }, 2500);
                } else {
                    winText.textContent = `${winType}!\n$${amount}`;
                    winOverlay.style.display = 'flex';
                    
                    if (this.sounds.win) this.sounds.win();
                    this.vibrate([100, 50, 100]);
                    
                    setTimeout(() => {
                        winOverlay.style.display = 'none';
                    }, 1500);
                }
                
                // Create coin effect
                this.createCoinEffect(amount);
            }

            changeBet() {
                this.betIndex = (this.betIndex + 1) % this.betLevels.length;
                this.currentBet = this.betLevels[this.betIndex];
                this.updateDisplay();
                
                if (this.sounds.button) this.sounds.button();
                this.showMessage(`Bet changed to $${this.currentBet}`);
            }

            maxBet() {
                this.betIndex = this.betLevels.length - 1;
                this.currentBet = this.betLevels[this.betIndex];
                this.updateDisplay();
                
                if (this.sounds.button) this.sounds.button();
                this.showMessage(`Maximum bet: $${this.currentBet}`);
            }

            cashOut() {
                if (this.credits > 0) {
                    this.showMessage(`Cashed out $${this.credits}! Thanks for playing!`);
                    this.vibrate([200, 100, 200, 100, 200]);
                    
                    // Reset credits after showing message
                    setTimeout(() => {
                        this.credits = 1000;
                        this.updateDisplay();
                    }, 2000);
                } else {
                    this.showMessage('No credits to cash out!');
                    this.vibrate([200]);
                }
            }

            toggleAutoSpin() {
                if (this.autoSpinActive) {
                    this.autoSpinActive = false;
                    this.autoSpinCount = 0;
                    document.getElementById('autoSpinButton').innerHTML = '🔄 AUTO SPIN<br><span style="font-size: 0.8rem;">Automatic Play</span>';
                    this.showMessage('Auto spin stopped');
                } else {
                    this.autoSpinActive = true;
                    this.autoSpinCount = 10; // Auto spin 10 times
                    document.getElementById('autoSpinButton').innerHTML = '⏹️ STOP AUTO<br><span style="font-size: 0.8rem;">Stop Auto Play</span>';
                    this.showMessage('Auto spin started (10 spins)');
                    
                    if (!this.isSpinning) {
                        this.spin();
                    }
                }
            }

            showPayTable() {
                let payTableText = '🎰 PAY TABLE 🎰\n\n';
                this.symbols.forEach(symbolData => {
                    if (symbolData.special) {
                        payTableText += `${symbolData.symbol} 3x: ${symbolData.special.toUpperCase()} FEATURE\n`;
                    } else {
                        payTableText += `${symbolData.symbol} `;
                        if (symbolData.payout[2]) payTableText += `2x: ${symbolData.payout[2]}x `;
                        if (symbolData.payout[3]) payTableText += `3x: ${symbolData.payout[3]}x`;
                        payTableText += '\n';
                    }
                });
                
                payTableText += '\n🎁 BONUS: Instant win up to 50x bet\n';
                payTableText += '🆓 FREE SPINS: 5-10 spins with 2x-4x multiplier\n\n';
                payTableText += `Games Played: ${this.gamesPlayed}\n`;
                payTableText += `Total Winnings: $${this.totalWinnings}`;
                
                alert(payTableText);
            }

            showSettings() {
                const settings = prompt(
                    '⚙️ GAME SETTINGS ⚙️\n\n' +
                    '1. Sound: ON\n' +
                    '2. Vibration: ON\n' +
                    '3. Auto-play speed: Normal\n\n' +
                    'Settings are automatically optimized for best experience!'
                );
            }

            showMessage(message) {
                // Create a temporary message overlay
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: #ffd700;
                    padding: 20px;
                    border-radius: 10px;
                    font-size: 1.2rem;
                    font-weight: bold;
                    text-align: center;
                    z-index: 1000;
                    border: 2px solid #ffd700;
                    box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
                `;
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 2000);
            }

            updateDisplay() {
                document.getElementById('credits').textContent = this.credits;
                document.getElementById('currentBet').textContent = this.currentBet;
                document.getElementById('lastWin').textContent = this.lastWin;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ProfessionalSlotMachine();
        });

        // Prevent context menu on long press
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (event) => {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>