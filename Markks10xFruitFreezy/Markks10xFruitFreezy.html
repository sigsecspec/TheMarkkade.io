<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#2d1b69" />
<title>Markk's 10x Fruity Frenzy - Razr Edition</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  body {
    background: 
      radial-gradient(circle at 30% 40%, rgba(255, 100, 150, 0.15) 0%, transparent 60%),
      radial-gradient(circle at 70% 60%, rgba(100, 255, 150, 0.12) 0%, transparent 55%),
      linear-gradient(145deg, #2d1b69 0%, #1a1a2e 25%, #16213e 50%, #0f0f23 75%, #1a0033 100%);
    color: #fff;
    font-family: 'Press Start 2P', cursive;
    user-select: none;
    overflow: hidden;
    position: relative;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
  }

  /* Animated fruit pattern background */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
      repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,100,150,0.03) 20px, rgba(255,100,150,0.03) 22px),
      repeating-linear-gradient(-45deg, transparent, transparent 20px, rgba(100,255,150,0.03) 20px, rgba(100,255,150,0.03) 22px);
    pointer-events: none;
    z-index: 0;
    animation: fruitPattern 8s ease-in-out infinite;
  }

  @keyframes fruitPattern {
    0%, 100% { opacity: 0.6; transform: rotate(0deg); }
    50% { opacity: 0.9; transform: rotate(0.5deg); }
  }

  /* Glowing fruit border */
  body::after {
    content: '';
    position: fixed;
    top: 8px;
    left: 8px;
    width: calc(100% - 16px);
    height: calc(100% - 16px);
    border: 3px solid rgba(255, 100, 150, 0.4);
    border-radius: 12px;
    pointer-events: none;
    z-index: 0;
    box-shadow: 
      inset 0 0 40px rgba(0,0,0,0.6),
      0 0 30px rgba(255, 100, 150, 0.3),
      inset 0 0 80px rgba(100, 255, 150, 0.1);
    animation: fruitBorderGlow 4s ease-in-out infinite;
  }

  @keyframes fruitBorderGlow {
    0%, 100% { 
      border-color: rgba(255, 100, 150, 0.4);
      box-shadow: 
        inset 0 0 40px rgba(0,0,0,0.6),
        0 0 30px rgba(255, 100, 150, 0.3),
        inset 0 0 80px rgba(100, 255, 150, 0.1);
    }
    50% { 
      border-color: rgba(100, 255, 150, 0.5);
      box-shadow: 
        inset 0 0 40px rgba(0,0,0,0.6),
        0 0 50px rgba(100, 255, 150, 0.4),
        inset 0 0 100px rgba(255, 100, 150, 0.15);
    }
  }

  .game-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 1;
  }
  
  /* Optimized for Razr 2023 - 22:9 aspect ratio, 6.9" display */
  .fold-top {
    flex: 1.2;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 16px;
    gap: 12px;
    background: linear-gradient(180deg, rgba(45,27,105,0.8) 0%, rgba(26,26,46,0.9) 100%);
    border-bottom: 3px solid rgba(255, 100, 150, 0.5);
    position: relative;
    overflow: hidden;
    box-shadow: inset 0 -20px 40px rgba(0,0,0,0.4);
  }

  /* Animated fruit wheel decoration */
  .fruit-wheel {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 450px;
    height: 450px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,100,150,0.12) 0%, transparent 70%);
    border: 6px solid rgba(100,255,150,0.2);
    pointer-events: none;
    z-index: 0;
    animation: fruitSpin 25s linear infinite, fruitGlow 5s ease-in-out infinite;
    box-shadow: 
      0 0 60px rgba(255, 100, 150, 0.2),
      inset 0 0 40px rgba(100, 255, 150, 0.1);
  }

  @keyframes fruitSpin {
    from { transform: translate(-50%, -50%) rotate(0deg); }
    to { transform: translate(-50%, -50%) rotate(360deg); }
  }

  @keyframes fruitGlow {
    0%, 100% { 
      box-shadow: 
        0 0 60px rgba(255, 100, 150, 0.2),
        inset 0 0 40px rgba(100, 255, 150, 0.1);
    }
    50% { 
      box-shadow: 
        0 0 90px rgba(100, 255, 150, 0.3),
        inset 0 0 60px rgba(255, 100, 150, 0.15);
    }
  }

  .fruit-wheel::before {
    content: 'üçéüçäüçåüçáüçì';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    animation: fruitSpin 25s linear infinite reverse;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
  }

  h1 {
    text-align: center;
    color: #00ff88;
    font-size: clamp(1.2rem, 4vw, 1.6rem);
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    text-shadow: 
      0 0 30px rgba(0, 255, 136, 0.6),
      0 0 15px rgba(0, 255, 136, 0.4),
      2px 2px 4px rgba(0,0,0,0.9);
    position: relative;
    z-index: 1;
    border: 2px solid rgba(0, 255, 136, 0.5);
    padding: 8px 16px;
    background: linear-gradient(135deg, rgba(45,27,105,0.95) 0%, rgba(26,26,46,0.98) 100%);
    border-radius: 8px;
    box-shadow: 
      0 6px 25px rgba(0,0,0,0.7),
      inset 0 1px 0 rgba(255,255,255,0.12),
      0 0 40px rgba(0, 255, 136, 0.3);
    animation: titlePulse 3s ease-in-out infinite;
  }

  @keyframes titlePulse {
    0%, 100% { 
      text-shadow: 
        0 0 30px rgba(0, 255, 136, 0.6),
        0 0 15px rgba(0, 255, 136, 0.4),
        2px 2px 4px rgba(0,0,0,0.9);
      box-shadow: 
        0 6px 25px rgba(0,0,0,0.7),
        inset 0 1px 0 rgba(255,255,255,0.12),
        0 0 40px rgba(0, 255, 136, 0.3);
    }
    50% { 
      text-shadow: 
        0 0 45px rgba(0, 255, 136, 0.8),
        0 0 25px rgba(0, 255, 136, 0.6),
        2px 2px 4px rgba(0,0,0,0.9);
      box-shadow: 
        0 6px 25px rgba(0,0,0,0.7),
        inset 0 1px 0 rgba(255,255,255,0.15),
        0 0 60px rgba(0, 255, 136, 0.5);
    }
  }

  .game-stats {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 100%;
    z-index: 1;
    padding: 0 8px;
  }
  
  #balance, #total-winnings {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 204, 255, 0.2) 100%);
    border: 2px solid rgba(0, 255, 136, 0.6);
    border-radius: 8px;
    padding: 10px 18px;
    box-shadow: 
      0 8px 30px rgba(0,0,0,0.8),
      inset 0 1px 0 rgba(255,255,255,0.1),
      inset 0 -1px 0 rgba(0,0,0,0.5),
      0 0 30px rgba(0, 255, 136, 0.2);
    color: #00ff88;
    font-size: clamp(0.9rem, 3vw, 1.1rem);
    font-weight: 700;
    letter-spacing: 1px;
    text-align: center;
    flex: 1;
    min-width: 120px;
    position: relative;
    text-shadow: 
      0 0 15px rgba(0, 255, 136, 0.4),
      0 2px 4px rgba(0,0,0,0.9);
    animation: statsGlow 4s ease-in-out infinite;
  }

  @keyframes statsGlow {
    0%, 100% { 
      box-shadow: 
        0 8px 30px rgba(0,0,0,0.8),
        inset 0 1px 0 rgba(255,255,255,0.1),
        inset 0 -1px 0 rgba(0,0,0,0.5),
        0 0 30px rgba(0, 255, 136, 0.2);
    }
    50% { 
      box-shadow: 
        0 8px 30px rgba(0,0,0,0.8),
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 -1px 0 rgba(0,0,0,0.5),
        0 0 45px rgba(0, 255, 136, 0.35);
    }
  }
  
  #slotContainer {
    position: relative;
    width: 100%;
    max-width: 100%;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(26,26,46, 0.6) 100%);
    border: 3px solid rgba(0, 255, 136, 0.4);
    border-radius: 10px;
    padding: 16px;
    box-shadow: 
      0 12px 50px rgba(0,0,0,0.95),
      inset 0 2px 0 rgba(255,255,255,0.08),
      inset 0 -2px 0 rgba(0,0,0,0.8),
      0 0 50px rgba(0, 255, 136, 0.2);
    z-index: 1;
    animation: containerPulse 5s ease-in-out infinite;
  }

  @keyframes containerPulse {
    0%, 100% { 
      box-shadow: 
        0 12px 50px rgba(0,0,0,0.95),
        inset 0 2px 0 rgba(255,255,255,0.08),
        inset 0 -2px 0 rgba(0,0,0,0.8),
        0 0 50px rgba(0, 255, 136, 0.2);
    }
    50% { 
      box-shadow: 
        0 12px 50px rgba(0,0,0,0.95),
        inset 0 2px 0 rgba(255,255,255,0.12),
        inset 0 -2px 0 rgba(0,0,0,0.8),
        0 0 75px rgba(0, 255, 136, 0.35);
    }
  }

  /* Fruit corner decorations */
  #slotContainer::before,
  #slotContainer::after {
    content: 'üçì';
    position: absolute;
    color: rgba(255, 100, 150, 0.8);
    font-size: 1.2rem;
    text-shadow: 
      0 0 15px rgba(255, 100, 150, 0.6),
      0 2px 4px rgba(0,0,0,0.8);
    animation: fruitBounce 3s ease-in-out infinite;
  }

  @keyframes fruitBounce {
    0%, 100% { 
      transform: scale(1) rotate(0deg);
      text-shadow: 
        0 0 15px rgba(255, 100, 150, 0.6),
        0 2px 4px rgba(0,0,0,0.8);
    }
    50% { 
      transform: scale(1.1) rotate(5deg);
      text-shadow: 
        0 0 25px rgba(255, 100, 150, 0.8),
        0 2px 4px rgba(0,0,0,0.8);
    }
  }

  #slotContainer::before {
    top: 6px;
    left: 6px;
  }

  #slotContainer::after {
    top: 6px;
    right: 6px;
    content: 'üçä';
    color: rgba(255, 165, 0, 0.8);
    text-shadow: 
      0 0 15px rgba(255, 165, 0, 0.6),
      0 2px 4px rgba(0,0,0,0.8);
  }
  
  #slotGrid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 5px;
    position: relative;
    z-index: 1;
  }
  
  .slotCell {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.15) 0%, rgba(0, 204, 255, 0.15) 100%);
    border: 2px solid rgba(0, 255, 136, 0.4);
    border-radius: 8px;
    font-size: clamp(1.6rem, 5vw, 2.4rem);
    text-align: center;
    box-shadow: 
      0 4px 15px rgba(0,0,0,0.9),
      inset 0 1px 0 rgba(255,255,255,0.06),
      inset 0 -1px 0 rgba(0,0,0,0.6);
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: all 0.3s ease;
    filter: drop-shadow(0 0 8px rgba(0, 255, 136, 0.2));
  }

  .slotCell::before {
    content: '';
    position: absolute;
    inset: 2px;
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 6px;
    pointer-events: none;
    box-shadow: inset 0 0 10px rgba(0, 255, 136, 0.1);
  }

  .slotCell.spinning {
    animation: fruitSpin 0.1s linear infinite;
    border-color: rgba(0, 255, 136, 0.8);
    box-shadow: 
      0 4px 15px rgba(0,0,0,0.9),
      inset 0 1px 0 rgba(255,255,255,0.08),
      inset 0 -1px 0 rgba(0,0,0,0.6),
      0 0 20px rgba(0, 255, 136, 0.4);
  }
  
  .winning {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.4) 0%, rgba(255, 165, 0, 0.4) 100%);
    border-color: rgba(255, 215, 0, 0.9);
    box-shadow: 
      0 0 35px rgba(255, 215, 0, 0.8),
      0 0 20px rgba(255, 215, 0, 0.6),
      0 4px 15px rgba(0,0,0,0.9),
      inset 0 1px 0 rgba(255,255,255,0.25),
      inset 0 0 20px rgba(255, 215, 0, 0.3);
    animation: fruitWinGlow 0.6s ease-in-out infinite alternate;
    filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
  }

  @keyframes fruitWinGlow {
    0% { 
      transform: scale(1);
      filter: brightness(1.3) drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
    }
    100% { 
      transform: scale(1.08);
      filter: brightness(1.7) drop-shadow(0 0 25px rgba(255, 215, 0, 0.9));
    }
  }
  
  #linesSvg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 2;
  }

  .winLine {
    stroke: #ffd700;
    stroke-width: 4;
    stroke-linecap: round;
    opacity: 0.95;
    filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.8)) drop-shadow(0 0 6px rgba(255, 215, 0, 0.6));
    animation: goldLineGlow 0.8s infinite ease-in-out;
  }
  
  @keyframes goldLineGlow {
    0%, 100% {
      stroke: #ffd700;
      stroke-width: 4;
      opacity: 0.95;
    }
    50% {
      stroke: #ffed4e;
      stroke-width: 6;
      opacity: 1;
    }
  }

  #message {
    text-align: center;
    font-size: clamp(0.8rem, 2.8vw, 0.95rem);
    min-height: 2em;
    color: #00ff88;
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 204, 255, 0.2) 100%);
    border: 2px solid rgba(0, 255, 136, 0.5);
    border-radius: 8px;
    padding: 10px 16px;
    box-shadow: 
      0 6px 25px rgba(0,0,0,0.8),
      inset 0 1px 0 rgba(255,255,255,0.08),
      0 0 30px rgba(0, 255, 136, 0.2);
    font-weight: 700;
    letter-spacing: 0.5px;
    text-shadow: 
      0 0 12px rgba(0, 255, 136, 0.4),
      0 2px 4px rgba(0,0,0,0.9);
    z-index: 1;
    animation: messageGlow 4s ease-in-out infinite;
  }

  @keyframes messageGlow {
    0%, 100% { 
      box-shadow: 
        0 6px 25px rgba(0,0,0,0.8),
        inset 0 1px 0 rgba(255,255,255,0.08),
        0 0 30px rgba(0, 255, 136, 0.2);
    }
    50% { 
      box-shadow: 
        0 6px 25px rgba(0,0,0,0.8),
        inset 0 1px 0 rgba(255,255,255,0.12),
        0 0 45px rgba(0, 255, 136, 0.35);
    }
  }
  
  .fold-bottom {
    flex: 0.8;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 16px;
    background: linear-gradient(180deg, rgba(26,26,46,0.9) 0%, rgba(15,15,35,0.95) 100%);
    position: relative;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    box-shadow: inset 0 20px 40px rgba(0,0,0,0.4);
  }

  #betSelector {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.15) 0%, rgba(0, 204, 255, 0.15) 100%);
    border: 2px solid rgba(0, 255, 136, 0.4);
    border-radius: 10px;
    padding: 12px;
    box-shadow: 
      0 8px 35px rgba(0,0,0,0.9),
      inset 0 1px 0 rgba(255,255,255,0.06),
      0 0 40px rgba(0, 255, 136, 0.2);
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 6px;
    width: 100%;
    max-width: 100%;
  }
  
  #betSelector button {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 204, 255, 0.2) 100%);
    border: 2px solid rgba(0, 255, 136, 0.5);
    color: #00ff88;
    padding: 10px 12px;
    font-weight: 700;
    font-size: clamp(0.8rem, 2.8vw, 0.9rem);
    cursor: pointer;
    border-radius: 6px;
    letter-spacing: 0.5px;
    box-shadow: 
      0 4px 15px rgba(0,0,0,0.7),
      inset 0 1px 0 rgba(255,255,255,0.08),
      0 0 15px rgba(0, 255, 136, 0.1);
    min-height: 44px;
    transition: all 0.3s ease;
    text-shadow: 0 2px 4px rgba(0,0,0,0.9);
  }

  #betSelector button:hover {
    transform: translateY(-2px);
    border-color: rgba(0, 255, 136, 0.8);
    box-shadow: 
      0 6px 20px rgba(0,0,0,0.9),
      inset 0 1px 0 rgba(255,255,255,0.12),
      0 0 25px rgba(0, 255, 136, 0.3);
  }

  #betSelector button.selected {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.4) 0%, rgba(0, 204, 255, 0.4) 100%);
    color: #ffffff;
    border-color: rgba(0, 255, 136, 0.9);
    box-shadow: 
      0 6px 25px rgba(0,0,0,1),
      inset 0 1px 0 rgba(255,255,255,0.18),
      0 0 35px rgba(0, 255, 136, 0.5);
    transform: translateY(-2px) scale(1.02);
    animation: selectedPulse 2s ease-in-out infinite;
  }

  @keyframes selectedPulse {
    0%, 100% { 
      box-shadow: 
        0 6px 25px rgba(0,0,0,1),
        inset 0 1px 0 rgba(255,255,255,0.18),
        0 0 35px rgba(0, 255, 136, 0.5);
    }
    50% { 
      box-shadow: 
        0 8px 30px rgba(0,0,0,1),
        inset 0 1px 0 rgba(255,255,255,0.22),
        0 0 50px rgba(0, 255, 136, 0.7);
    }
  }

  .action-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    width: 100%;
    max-width: 100%;
  }

  .action-buttons button {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 204, 255, 0.2) 100%);
    border: 2px solid rgba(0, 255, 136, 0.5);
    color: #00ff88;
    padding: 10px;
    font-weight: 700;
    font-size: clamp(0.7rem, 2.5vw, 0.8rem);
    cursor: pointer;
    border-radius: 6px;
    letter-spacing: 0.5px;
    box-shadow: 
      0 4px 15px rgba(0,0,0,0.7),
      inset 0 1px 0 rgba(255,255,255,0.08);
    min-height: 42px;
    transition: all 0.3s ease;
    text-shadow: 0 2px 4px rgba(0,0,0,0.9);
  }

  #spinBtn {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.4) 0%, rgba(0, 204, 255, 0.4) 100%);
    color: #ffffff;
    font-weight: 800;
    font-size: clamp(1.2rem, 4vw, 1.4rem);
    padding: 14px 32px;
    border: 3px solid rgba(0, 255, 136, 0.8);
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 
      0 10px 40px rgba(0,0,0,1),
      inset 0 2px 0 rgba(255,255,255,0.15),
      inset 0 -2px 0 rgba(0,0,0,0.7),
      0 0 50px rgba(0, 255, 136, 0.4);
    letter-spacing: 2px;
    min-width: 90%;
    text-shadow: 
      0 0 20px rgba(0, 255, 136, 0.6),
      0 3px 6px rgba(0,0,0,1);
    position: relative;
    transition: all 0.3s ease;
    animation: spinButtonGlow 3s ease-in-out infinite;
    grid-column: 1 / -1;
  }

  @keyframes spinButtonGlow {
    0%, 100% { 
      box-shadow: 
        0 10px 40px rgba(0,0,0,1),
        inset 0 2px 0 rgba(255,255,255,0.15),
        inset 0 -2px 0 rgba(0,0,0,0.7),
        0 0 50px rgba(0, 255, 136, 0.4);
    }
    50% { 
      box-shadow: 
        0 12px 45px rgba(0,0,0,1),
        inset 0 2px 0 rgba(255,255,255,0.2),
        inset 0 -2px 0 rgba(0,0,0,0.7),
        0 0 70px rgba(0, 255, 136, 0.6);
    }
  }

  #spinBtn::before {
    content: 'üé∞';
    margin-right: 8px;
    filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.4));
    animation: fruitSparkle 2s ease-in-out infinite;
  }

  #spinBtn::after {
    content: 'üé∞';
    margin-left: 8px;
    filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.4));
    animation: fruitSparkle 2s ease-in-out infinite;
  }

  @keyframes fruitSparkle {
    0%, 100% { 
      filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.4));
      opacity: 1;
    }
    50% { 
      filter: drop-shadow(0 0 18px rgba(0, 255, 136, 0.7));
      opacity: 0.8;
    }
  }

  #spinBtn:hover {
    transform: translateY(-3px);
    box-shadow: 
      0 14px 50px rgba(0,0,0,1),
      inset 0 2px 0 rgba(255,255,255,0.2),
      0 0 70px rgba(0, 255, 136, 0.6);
    border-color: rgba(0, 255, 136, 1);
  }

  #spinBtn:active {
    transform: translateY(-1px);
  }
  
  #spinBtn:disabled {
    background: linear-gradient(135deg, rgba(60,60,65,0.8) 0%, rgba(45,45,50,0.9) 100%);
    color: rgba(255, 255, 255, 0.35);
    cursor: not-allowed;
    border-color: rgba(100, 100, 110, 0.6);
    box-shadow: 
      0 6px 20px rgba(0,0,0,0.6),
      inset 0 1px 0 rgba(255,255,255,0.05);
    transform: none;
    animation: none;
  }

  /* Shopping List Modal Styles */
  #paytableModal {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 16px;
  }

  #paytableModal.open {
    display: flex;
  }

  .modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(8px);
  }

  .modal-dialog {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 420px;
    max-height: 85vh;
    background: #ffffff;
    border: 3px dashed #2d1b69;
    border-radius: 0;
    padding: 25px 18px 18px;
    box-shadow: 
      0 12px 40px rgba(0,0,0,0.9),
      inset 0 0 0 2px #ffffff;
    overflow: auto;
    font-family: 'Courier New', monospace;
  }

  #closePayTableBtn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: #ffffff;
    border: 2px solid #2d1b69;
    color: #2d1b69;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  #payTableContainer {
    margin-top: 0;
    background: transparent;
  }

  /* Shopping List Header */
  .shopping-header {
    text-align: center;
    margin-bottom: 18px;
    border-bottom: 3px dashed #2d1b69;
    padding-bottom: 12px;
  }

  .shopping-header h3 {
    color: #2d1b69;
    font-size: 1.3rem;
    letter-spacing: 2px;
    margin-bottom: 6px;
    font-weight: 900;
  }

  .shopping-header p {
    color: #2d1b69;
    font-size: 0.7rem;
    margin: 2px 0;
    letter-spacing: 1px;
  }

  /* Shopping List Items */
  .shopping-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .shopping-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    margin-bottom: 6px;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    background: linear-gradient(90deg, #f9f9f9 0%, #ffffff 100%);
    font-size: 0.75rem;
    color: #2d1b69;
    font-weight: 600;
  }

  .shopping-item:nth-child(5n) {
    border-bottom: 2px solid #2d1b69;
    margin-bottom: 12px;
  }

  .shopping-item:hover {
    background: linear-gradient(90deg, #f0f8ff 0%, #e6f3ff 100%);
    border-color: #2d1b69;
  }

  .fruit-info {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .fruit-emoji {
    font-size: 1.2rem;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));
  }

  .fruit-details {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .fruit-name {
    font-weight: 800;
    color: #2d1b69;
    font-size: 0.8rem;
  }

  .fruit-rule {
    font-size: 0.65rem;
    color: #666;
    font-style: italic;
  }

  .price-list {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 2px;
    font-size: 0.65rem;
    color: #2d1b69;
  }

  .price-row {
    white-space: nowrap;
    font-weight: 700;
  }

  .special-item {
    background: linear-gradient(90deg, #fff3cd 0%, #ffeaa7 100%);
    border-color: #f39c12;
    color: #d68910;
  }

  .special-item .fruit-name {
    color: #d68910;
  }

  /* Shopping List Footer */
  .shopping-footer {
    margin-top: 18px;
    padding-top: 12px;
    border-top: 3px dashed #2d1b69;
    text-align: center;
  }

  .shopping-footer p {
    color: #2d1b69;
    font-size: 0.65rem;
    margin: 4px 0;
    line-height: 1.4;
  }

  .shopping-footer .special {
    font-weight: 900;
    font-size: 0.75rem;
    margin-top: 8px;
    color: #d68910;
  }

  .shopping-total {
    background: #2d1b69;
    color: #ffffff;
    padding: 8px;
    margin: 8px -6px 0;
    border-radius: 4px;
    font-weight: 900;
    font-size: 0.8rem;
  }

  body.modal-open {
    overflow: hidden;
  }

  /* Razr 2023 optimizations - 6.9" display, 1080x2640px, 22:9 aspect ratio */
  @media (max-width: 480px) and (min-height: 800px) {
    .fold-top {
      padding: 12px 10px;
      gap: 8px;
    }
    
    .fold-bottom {
      padding: 12px 10px;
      gap: 10px;
    }
    
    h1 {
      font-size: clamp(1rem, 3.5vw, 1.2rem);
      padding: 6px 12px;
      letter-spacing: 1.5px;
    }

    .game-stats {
      gap: 8px;
      width: 100%;
      padding: 0 4px;
    }
    
    #balance, #total-winnings {
      min-width: 0;
      padding: 8px 14px;
      font-size: clamp(0.8rem, 2.8vw, 0.95rem);
      letter-spacing: 0.5px;
    }
    
    #slotContainer {
      padding: 12px;
      max-width: 100%;
      margin: 0;
    }
    
    #slotGrid {
      gap: 4px;
    }
    
    .slotCell {
      font-size: clamp(1.4rem, 4.5vw, 2rem);
    }
    
    #betSelector {
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      padding: 10px;
      max-width: 100%;
    }
    
    #betSelector button {
      min-height: 40px;
      font-size: clamp(0.75rem, 2.5vw, 0.85rem);
      padding: 8px 8px;
      letter-spacing: 0.3px;
    }
    
    .action-buttons {
      gap: 8px;
    }

    .action-buttons button {
      font-size: clamp(0.65rem, 2.2vw, 0.75rem);
      padding: 8px;
      min-height: 38px;
    }
    
    #spinBtn {
      padding: 12px 28px;
      min-width: 92%;
      font-size: clamp(1.1rem, 3.5vw, 1.25rem);
      letter-spacing: 1.5px;
    }
    
    #message {
      font-size: clamp(0.75rem, 2.5vw, 0.85rem);
      padding: 8px 12px;
      width: 100%;
      letter-spacing: 0.3px;
      min-height: 1.8em;
    }

    .fruit-wheel {
      width: 350px;
      height: 350px;
    }

    .fruit-wheel::before {
      font-size: 1.6rem;
    }
  }

  /* Extra compact for smaller screens */
  @media (max-width: 380px) {
    #betSelector {
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
    }

    .fruit-wheel {
      width: 300px;
      height: 300px;
    }

    .fruit-wheel::before {
      font-size: 1.4rem;
    }
  }

  /* Landscape mode optimization */
  @media (orientation: landscape) and (max-height: 480px) {
    .fold-top, .fold-bottom {
      padding: 6px;
      gap: 4px;
    }

    h1 {
      font-size: 0.9rem;
      padding: 4px 8px;
    }

    #slotContainer {
      padding: 8px;
    }

    #slotGrid {
      gap: 3px;
    }

    .fruit-wheel {
      width: 250px;
      height: 250px;
    }

    .fruit-wheel::before {
      font-size: 1.2rem;
    }
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
</head>
<body>

<div class="game-container">
  <div class="fold-top">
    <div class="fruit-wheel"></div>
    <h1>Markk's 10x Fruity Frenzy</h1>
    
    <div class="game-stats">
      <div id="balance">Balance: $0</div>
      <div id="total-winnings">Total Winnings: $0</div>
    </div>
    
    <div id="slotContainer">
      <div id="slotGrid"></div>
      <svg id="linesSvg"></svg>
    </div>
    
    <div id="message">Place Your Bet & Spin!</div>
  </div>

  <div class="fold-bottom">
    <div id="betSelector">
      <button data-bet="1">$1</button>
      <button data-bet="10" class="selected">$10</button>
      <button data-bet="20">$20</button>
      <button data-bet="30">$30</button>
      <button data-bet="40">$40</button>
      <button data-bet="50">$50</button>
    </div>

    <div class="action-buttons">
      <button id="openPayTableBtn">üõí Shopping List</button>
      <button id="spinBtn">SPIN</button>
      <button id="exitBtn">üö™ Exit (-$5)</button>
    </div>
  </div>
</div>

<!-- Shopping List Modal -->
<div id="paytableModal">
  <div class="modal-backdrop" data-close="true"></div>
  <div class="modal-dialog">
    <button id="closePayTableBtn">‚úï</button>
    <div id="payTableContainer">
      <div class="shopping-header">
        <h3>üõí FRUIT MARKET</h3>
        <p>OFFICIAL PRICE LIST</p>
        <p>‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</p>
        <p style="font-size: 0.6rem;">Fresh Fruits ‚Ä¢ Best Prices ‚Ä¢ Daily Specials</p>
      </div>
      
      <ul class="shopping-list">
        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçé</span>
            <div class="fruit-details">
              <span class="fruit-name">Red Apple</span>
              <span class="fruit-rule">1-3 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $1/$2/$3</span>
            <span class="price-row">$10: $11/$22/$33</span>
            <span class="price-row">$20: $22/$44/$66</span>
            <span class="price-row">$30: $33/$66/$99</span>
            <span class="price-row">$40: $44/$88/$132</span>
            <span class="price-row">$50: $55/$110/$165</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçè</span>
            <div class="fruit-details">
              <span class="fruit-name">Green Apple</span>
              <span class="fruit-rule">1-3 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $1/$2/$3</span>
            <span class="price-row">$10: $11/$22/$33</span>
            <span class="price-row">$20: $22/$44/$66</span>
            <span class="price-row">$30: $33/$66/$99</span>
            <span class="price-row">$40: $44/$88/$132</span>
            <span class="price-row">$50: $55/$110/$165</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçë</span>
            <div class="fruit-details">
              <span class="fruit-name">Cherry</span>
              <span class="fruit-rule">3-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $5/$10/$20</span>
            <span class="price-row">$10: $55/$110/$220</span>
            <span class="price-row">$20: $110/$220/$440</span>
            <span class="price-row">$30: $165/$330/$660</span>
            <span class="price-row">$40: $220/$440/$880</span>
            <span class="price-row">$50: $275/$550/$1100</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçê</span>
            <div class="fruit-details">
              <span class="fruit-name">Pear</span>
              <span class="fruit-rule">3-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $5/$10/$20</span>
            <span class="price-row">$10: $55/$110/$220</span>
            <span class="price-row">$20: $110/$220/$440</span>
            <span class="price-row">$30: $165/$330/$660</span>
            <span class="price-row">$40: $220/$440/$880</span>
            <span class="price-row">$50: $275/$550/$1100</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçä</span>
            <div class="fruit-details">
              <span class="fruit-name">Orange</span>
              <span class="fruit-rule">3-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $5/$10/$20</span>
            <span class="price-row">$10: $55/$110/$220</span>
            <span class="price-row">$20: $110/$220/$440</span>
            <span class="price-row">$30: $165/$330/$660</span>
            <span class="price-row">$40: $220/$440/$880</span>
            <span class="price-row">$50: $275/$550/$1100</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçã</span>
            <div class="fruit-details">
              <span class="fruit-name">Lemon</span>
              <span class="fruit-rule">3-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $5/$10/$20</span>
            <span class="price-row">$10: $55/$110/$220</span>
            <span class="price-row">$20: $110/$220/$440</span>
            <span class="price-row">$30: $165/$330/$660</span>
            <span class="price-row">$40: $220/$440/$880</span>
            <span class="price-row">$50: $275/$550/$1100</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçå</span>
            <div class="fruit-details">
              <span class="fruit-name">Banana</span>
              <span class="fruit-rule">4-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $8/$16</span>
            <span class="price-row">$10: $88/$176</span>
            <span class="price-row">$20: $176/$352</span>
            <span class="price-row">$30: $264/$528</span>
            <span class="price-row">$40: $352/$704</span>
            <span class="price-row">$50: $440/$880</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçç</span>
            <div class="fruit-details">
              <span class="fruit-name">Pineapple</span>
              <span class="fruit-rule">4-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $8/$16</span>
            <span class="price-row">$10: $88/$176</span>
            <span class="price-row">$20: $176/$352</span>
            <span class="price-row">$30: $264/$528</span>
            <span class="price-row">$40: $352/$704</span>
            <span class="price-row">$50: $440/$880</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçì</span>
            <div class="fruit-details">
              <span class="fruit-name">Strawberry</span>
              <span class="fruit-rule">4-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $8/$16</span>
            <span class="price-row">$10: $88/$176</span>
            <span class="price-row">$20: $176/$352</span>
            <span class="price-row">$30: $264/$528</span>
            <span class="price-row">$40: $352/$704</span>
            <span class="price-row">$50: $440/$880</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">ü•≠</span>
            <div class="fruit-details">
              <span class="fruit-name">Mango</span>
              <span class="fruit-rule">4-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $8/$16</span>
            <span class="price-row">$10: $88/$176</span>
            <span class="price-row">$20: $176/$352</span>
            <span class="price-row">$30: $264/$528</span>
            <span class="price-row">$40: $352/$704</span>
            <span class="price-row">$50: $440/$880</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçá</span>
            <div class="fruit-details">
              <span class="fruit-name">Grapes</span>
              <span class="fruit-rule">4-5 in a row</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $8/$16</span>
            <span class="price-row">$10: $88/$176</span>
            <span class="price-row">$20: $176/$352</span>
            <span class="price-row">$30: $264/$528</span>
            <span class="price-row">$40: $352/$704</span>
            <span class="price-row">$50: $440/$880</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçâ</span>
            <div class="fruit-details">
              <span class="fruit-name">Watermelon</span>
              <span class="fruit-rule">5 in a row only</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $25</span>
            <span class="price-row">$10: $275</span>
            <span class="price-row">$20: $550</span>
            <span class="price-row">$30: $825</span>
            <span class="price-row">$40: $1100</span>
            <span class="price-row">$50: $1375</span>
          </div>
        </li>

        <li class="shopping-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçà</span>
            <div class="fruit-details">
              <span class="fruit-name">Melon</span>
              <span class="fruit-rule">5 in a row only</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">$1: $25</span>
            <span class="price-row">$10: $275</span>
            <span class="price-row">$20: $550</span>
            <span class="price-row">$30: $825</span>
            <span class="price-row">$40: $1100</span>
            <span class="price-row">$50: $1375</span>
          </div>
        </li>

        <li class="shopping-item special-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçí</span>
            <div class="fruit-details">
              <span class="fruit-name">Cherry Bonus</span>
              <span class="fruit-rule">Free Spins Special</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">3 = 5 Free Spins</span>
            <span class="price-row">5 = 10 Free Spins</span>
          </div>
        </li>

        <li class="shopping-item special-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üõí</span>
            <div class="fruit-details">
              <span class="fruit-name">Wild Cart</span>
              <span class="fruit-rule">Substitutes any fruit</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">Helps complete</span>
            <span class="price-row">winning matches</span>
          </div>
        </li>

        <li class="shopping-item special-item">
          <div class="fruit-info">
            <span class="fruit-emoji">ü•ùü••</span>
            <div class="fruit-details">
              <span class="fruit-name">Kiwi/Coconut</span>
              <span class="fruit-rule">Respin trigger</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">Triggers automatic</span>
            <span class="price-row">respin feature</span>
          </div>
        </li>

        <li class="shopping-item special-item">
          <div class="fruit-info">
            <span class="fruit-emoji">üçÖ</span>
            <div class="fruit-details">
              <span class="fruit-name">Tomato</span>
              <span class="fruit-rule">Line breaker</span>
            </div>
          </div>
          <div class="price-list">
            <span class="price-row">Blocks winning</span>
            <span class="price-row">combinations</span>
          </div>
        </li>
      </ul>
      
      <div class="shopping-footer">
        <p>‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</p>
        <div class="shopping-total">
          üé∞ TOTAL SAVINGS: Play Smart & Win Big! üé∞
        </div>
        <p class="special">üõí Fresh Fruit Market - Best Odds in Town!</p>
        <p>All prices subject to luck and skill</p>
        <p>Bonus features included at no extra cost</p>
        <p style="margin-top: 8px; font-size: 0.6rem;">THANK YOU FOR SHOPPING WITH US!</p>
        <p style="font-size: 0.6rem;">Markk's Fruity Frenzy ¬© 2025</p>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  'use strict';

  const fruits = [
    "üçé", "üçè", "üçë", "üçê", "üçä", "üçã", "üçå", "üçç", "üçì", "ü•≠", "üçá", "üçâ", "üçà", "üçí"
  ];
  const rows = 3;
  const cols = 5;
  const gridElement = document.getElementById("slotGrid");
  const balanceElement = document.getElementById("balance");
  const winningsElement = document.getElementById("total-winnings");
  const spinBtn = document.getElementById("spinBtn");
  const betSelector = document.getElementById("betSelector");
  const exitBtn = document.getElementById("exitBtn");
  const messageEl = document.getElementById("message");
  const openPayTableBtn = document.getElementById("openPayTableBtn");
  const paytableModal = document.getElementById("paytableModal");
  const closePayTableBtn = document.getElementById("closePayTableBtn");
  const linesSvg = document.getElementById("linesSvg");

  let balance = Number(localStorage.getItem('localPlayerCash')) || 0;
  let totalWinnings = 0;
  let spinning = false;

  let grid = []; // 2d array for current slot symbols

  // Enhanced sound system for fruit theme
  let audioContext = null;

  function initAudio() {
    if (!audioContext) {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioContext.state === 'suspended') {
      audioContext.resume();
    }
    return audioContext;
  }

  function playFruitSound(type) {
    try {
      const ctx = initAudio();
      const now = ctx.currentTime;
      
      if (type === 'spin') {
        // Fruit machine spinning sound
        for (let i = 0; i < 6; i++) {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          
          osc.frequency.value = 300 + (i * 80);
          osc.type = 'square';
          gain.gain.setValueAtTime(0.08, now + i * 0.04);
          gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.04 + 0.06);
          
          osc.start(now + i * 0.04);
          osc.stop(now + i * 0.04 + 0.06);
        }
      } else if (type === 'reel_stop') {
        // Fruit reel stopping
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        osc.frequency.value = 150;
        osc.type = 'triangle';
        gain.gain.setValueAtTime(0.12, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
        
        osc.start(now);
        osc.stop(now + 0.12);
      } else if (type === 'win') {
        // Fruit win chime
        [523.25, 659.25, 783.99].forEach((freq, i) => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          
          osc.frequency.value = freq;
          osc.type = 'sine';
          gain.gain.setValueAtTime(0.15, now + i * 0.1);
          gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.3);
          
          osc.start(now + i * 0.1);
          osc.stop(now + i * 0.1 + 0.3);
        });
      } else if (type === 'bigwin') {
        // Fruit jackpot celebration
        for (let i = 0; i < 12; i++) {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          
          osc.frequency.value = 500 + (i * 100);
          osc.type = 'sine';
          gain.gain.setValueAtTime(0.12, now + i * 0.08);
          gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.08 + 0.25);
          
          osc.start(now + i * 0.08);
          osc.stop(now + i * 0.08 + 0.25);
        }
      } else if (type === 'button') {
        // Fruit button press
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        osc.frequency.value = 800;
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.08, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
        
        osc.start(now);
        osc.stop(now + 0.05);
      }
    } catch (e) {
      console.log('Audio playback failed:', e);
    }
  }

  // Initialize audio on first user interaction
  document.addEventListener('click', () => initAudio(), { once: true });
  document.addEventListener('touchstart', () => initAudio(), { once: true });

  // Load wallet from localStorage on load
  function loadWallet() {
    balance = Number(localStorage.getItem('localPlayerCash')) || 0;
    updateBalance();
    updateTotalWinnings();
  }

  // Save wallet to localStorage
  function saveWallet() {
    localStorage.setItem('localPlayerCash', balance);
  }

  // Initialize grid UI and data
  function initGrid() {
    gridElement.innerHTML = "";
    grid = [];
    for (let r = 0; r < rows; r++) {
      let rowArr = [];
      for (let c = 0; c < cols; c++) {
        const cell = document.createElement("div");
        cell.classList.add("slotCell");
        cell.textContent = "‚ùì";
        gridElement.appendChild(cell);
        rowArr.push(cell);
      }
      grid.push(rowArr);
    }
  }
  initGrid();

  const weightedFruits = [
    "üçé","üçè","üçä","üõí","üçê","üçí", // common fruits
    "üçá","üçí","üçä","üçã","üçê",
    "üçë","üçá","üçà","üçâ", // rare
    "üçå","üõí","üçä","üçã","üçê",
    "üçå","üçç","üçì","üçí", // mid-tier
    "ü•ù","ü••","üçÖ", // blockers or specials
    "üçë","üçá","üçà","üçâ", // rare
    "üõí","üçí" // wild/bonus, very rare
  ];

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  shuffleArray(weightedFruits);

  function getRandomFruit() {
    return weightedFruits[Math.floor(Math.random() * weightedFruits.length)];
  }

  // Create fruit particles for wins
  function createFruitParticles(winPositions) {
    winPositions.forEach(pos => {
      const [r, c] = pos;
      const cell = grid[r][c];
      const rect = cell.getBoundingClientRect();
      
      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'fixed';
        particle.style.left = rect.left + rect.width / 2 + 'px';
        particle.style.top = rect.top + rect.height / 2 + 'px';
        particle.style.fontSize = '1.5rem';
        particle.style.pointerEvents = 'none';
        particle.style.zIndex = '1000';
        particle.style.color = '#ffd700';
        particle.style.filter = 'drop-shadow(0 0 8px rgba(255, 215, 0, 0.8))';
        particle.textContent = ['üçé', 'üçä', 'üçå', 'üçá', 'üçì', 'ü•≠', 'üçç', 'üçë'][Math.floor(Math.random() * 8)];
        
        document.body.appendChild(particle);
        
        const angle = (i / 8) * Math.PI * 2;
        const velocity = 100 + Math.random() * 60;
        const lifetime = 1200 + Math.random() * 400;
        
        particle.animate([
          { 
            transform: 'translate(0, 0) scale(1) rotate(0deg)',
            opacity: 1
          },
          { 
            transform: `translate(${Math.cos(angle) * velocity}px, ${Math.sin(angle) * velocity}px) scale(0) rotate(720deg)`,
            opacity: 0
          }
        ], {
          duration: lifetime,
          easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
        }).onfinish = () => {
          document.body.removeChild(particle);
        };
      }
    });
  }

  // Spin columns one by one from left to right with delay
  async function spin() {
    if (spinning) return;
    const selectedBetBtn = betSelector.querySelector('button.selected');
    const bet = parseInt(selectedBetBtn.dataset.bet);
    
    if (bet > balance) {
      showMessage("Insufficient balance to place this bet!");
      return;
    }
    spinning = true;
    clearWinHighlights();
    clearLines();
    balance -= bet;
    saveWallet();
    updateBalance();

    playFruitSound('spin');

    // Simulate spinning effect: each column cycles random fruits 15 times with delay
    const spinSpeed = 60; // ms delay per iteration
    const spinsPerCol = 18;

    // Prepare result array
    const results = Array(rows).fill(null).map(() => Array(cols).fill(null));

    for (let c = 0; c < cols; c++) {
      for (let spinCount = 0; spinCount < spinsPerCol; spinCount++) {
        for (let r = 0; r < rows; r++) {
          grid[r][c].textContent = getRandomFruit();
          grid[r][c].classList.add('spinning');
        }
        await new Promise(r => setTimeout(r, spinSpeed));
      }
      // After spins, fix column with final random fruits
      for (let r = 0; r < rows; r++) {
        const finalFruit = getRandomFruit();
        grid[r][c].textContent = finalFruit;
        grid[r][c].classList.remove('spinning');
        results[r][c] = finalFruit;
      }
      playFruitSound('reel_stop');
      await new Promise(r => setTimeout(r, 100));
    }

    // Analyze results and calculate winnings
    const winInfo = checkWins(results, bet);

    if (winInfo.winningLines.length > 0) {
      highlightWins(winInfo.winningPositions);
      drawWinLines(winInfo.winningPositions);
      createFruitParticles(winInfo.winningPositions);
      balance += winInfo.totalWin;
      totalWinnings += winInfo.totalWin;
      saveWallet();
      updateBalance();
      updateTotalWinnings();
      
      if (winInfo.totalWin > bet * 10) {
        playFruitSound('bigwin');
        showMessage(`üéâ FRUIT JACKPOT! Won $${winInfo.totalWin}! üéâ`);
      } else {
        playFruitSound('win');
        showMessage(`üçì Fresh Win! $${winInfo.totalWin}! üçì`);
      }
    } else {
      showMessage("No fresh matches. Try again!");
    }

    spinning = false;
  }

  // Clears all win highlight classes
  function clearWinHighlights() {
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        grid[r][c].classList.remove("winning");
      }
    }
  }

  // Clear win lines
  function clearLines() {
    while(linesSvg.firstChild) linesSvg.removeChild(linesSvg.firstChild);
  }

  // Draw win lines
  function drawWinLines(winPositions) {
    clearLines();
    if (winPositions.length < 2) return;
    
    const svgNS = "http://www.w3.org/2000/svg";
    for(let i = 0; i < winPositions.length - 1; i++) {
      const [r1, c1] = winPositions[i];
      const [r2, c2] = winPositions[i + 1];
      const fromCell = grid[r1][c1];
      const toCell = grid[r2][c2];
      const fromRect = fromCell.getBoundingClientRect();
      const toRect = toCell.getBoundingClientRect();
      const svgRect = linesSvg.getBoundingClientRect();
      const x1 = fromRect.left + fromRect.width/2 - svgRect.left;
      const y1 = fromRect.top + fromRect.height/2 - svgRect.top;
      const x2 = toRect.left + toRect.width/2 - svgRect.left;
      const y2 = toRect.top + toRect.height/2 - svgRect.top;
      const line = document.createElementNS(svgNS, 'line');
      line.setAttribute('x1', x1);
      line.setAttribute('y1', y1);
      line.setAttribute('x2', x2);
      line.setAttribute('y2', y2);
      line.classList.add('winLine');
      linesSvg.appendChild(line);
    }
  }

  // Highlight winning positions
  function highlightWins(positions) {
    positions.forEach(pos => {
      const [r, c] = pos;
      if (grid[r] && grid[r][c]) grid[r][c].classList.add("winning");
    });
  }

  // Update UI balance
  function updateBalance() {
    balanceElement.textContent = `Balance: $${balance}`;
  }

  // Update UI total winnings
  function updateTotalWinnings() {
    winningsElement.textContent = `Total Winnings: $${totalWinnings}`;
  }

  // Check wins for rows only (maintaining original game mechanics)
  function checkWins(results, bet) {
    const payouts = {
      "üçé": [1, 2, 3],
      "üçè": [1, 2, 3],
      "üçë": [5, 10, 20, 0, 0],
      "üçê": [5, 10, 20, 0, 0],
      "üçä": [5, 10, 20, 0, 0],
      "üçã": [5, 10, 20, 0, 0],
      "üçå": [0, 0, 0, 8, 16],
      "üçç": [0, 0, 0, 8, 16],
      "üçì": [0, 0, 0, 8, 16],
      "ü•≠": [0, 0, 0, 8, 16],
      "üçá": [0, 0, 0, 8, 16],
      "üçâ": [0, 0, 0, 0, 25],
      "üçà": [0, 0, 0, 0, 25],
    };

    let totalWin = 0;
    const winningLines = [];
    const winningPositions = [];

    for (let r = 0; r < rows; r++) {
      let currentFruit = null;
      let count = 0;
      for (let c = 0; c < cols; c++) {
        const fruit = results[r][c];
        if (fruit === currentFruit) {
          count++;
        } else {
          if (currentFruit && count >= 1) {
            const payoutsArr = payouts[currentFruit];
            if (payoutsArr) {
              let payoutIndex = count - 1;
              if (currentFruit === "üçé" || currentFruit === "üçè") {
                if (payoutIndex > 2) payoutIndex = 2;
              } else if (["üçë","üçê","üçä","üçã"].includes(currentFruit)) {
                if (count < 3) payoutIndex = -1;
                else if (payoutIndex > 2) payoutIndex = 2;
              } else if (["üçå","üçç","üçì","ü•≠","üçá"].includes(currentFruit)) {
                if (count < 4) payoutIndex = -1;
                else if (payoutIndex > 4) payoutIndex = 4;
              } else if (["üçâ","üçà"].includes(currentFruit)) {
                if (count !== 5) payoutIndex = -1;
                else payoutIndex = 4;
              } else {
                payoutIndex = -1;
              }
              if (payoutIndex >= 0 && payoutsArr[payoutIndex] > 0) {
                const winAmount = payoutsArr[payoutIndex] * bet;
                totalWin += winAmount;
                winningLines.push({row: r, fruit: currentFruit, count});
                for(let i=c-count; i < c; i++) {
                  winningPositions.push([r, i]);
                }
              }
            }
          }
          currentFruit = fruit;
          count = 1;
        }
      }
      // Evaluate last run in row
      if (currentFruit && count >= 1) {
        const payoutsArr = payouts[currentFruit];
        if (payoutsArr) {
          let payoutIndex = count - 1;
          if (currentFruit === "üçé" || currentFruit === "üçè") {
            if (payoutIndex > 2) payoutIndex = 2;
          } else if (["üçë","üçê","üçä","üçã"].includes(currentFruit)) {
            if (count < 3) payoutIndex = -1;
            else if (payoutIndex > 2) payoutIndex = 2;
          } else if (["üçå","üçç","üçì","ü•≠","üçá"].includes(currentFruit)) {
            if (count < 4) payoutIndex = -1;
            else if (payoutIndex > 4) payoutIndex = 4;
          } else if (["üçâ","üçà"].includes(currentFruit)) {
            if (count !== 5) payoutIndex = -1;
            else payoutIndex = 4;
          } else {
            payoutIndex = -1;
          }
          if (payoutIndex >= 0 && payoutsArr[payoutIndex] > 0) {
            const winAmount = payoutsArr[payoutIndex] * bet;
            totalWin += winAmount;
            winningLines.push({row: r, fruit: currentFruit, count});
            for(let i=cols-count; i < cols; i++) {
              winningPositions.push([r, i]);
            }
          }
        }
      }
    }

    return {totalWin, winningLines, winningPositions};
  }

  function showMessage(message) {
    messageEl.textContent = message;
  }

  function exitGame() {
    if (balance >= 5) {
      balance -= 5;
      saveWallet();
      updateBalance();
      window.location.href = "../index.html";
    } else {
      showMessage("You need at least $5 to exit the game!");
    }
  }

  // Modal functions
  function openPaytable() {
    paytableModal.classList.add('open');
    document.body.classList.add('modal-open');
  }

  function closePaytable() {
    paytableModal.classList.remove('open');
    document.body.classList.remove('modal-open');
  }

  // Event listeners
  spinBtn.addEventListener("click", () => {
    playFruitSound('button');
    spin();
  });
  
  exitBtn.addEventListener("click", () => {
    playFruitSound('button');
    exitGame();
  });

  betSelector.addEventListener('click', e => {
    if (e.target.tagName !== 'BUTTON') return;
    playFruitSound('button');
    betSelector.querySelectorAll('button').forEach(b => {
      b.classList.remove('selected');
    });
    e.target.classList.add('selected');
  });

  openPayTableBtn.addEventListener('click', () => {
    playFruitSound('button');
    openPaytable();
  });
  
  closePayTableBtn.addEventListener('click', () => {
    playFruitSound('button');
    closePaytable();
  });
  
  paytableModal.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal-backdrop') || e.target.dataset.close === 'true') {
      closePaytable();
    }
  });

  // Load wallet and initialize UI on page load
  window.addEventListener("load", () => {
    loadWallet();
    showMessage("Welcome to Fruity Frenzy! Place your bet!");
  });

})();
</script>
</body>
</html>