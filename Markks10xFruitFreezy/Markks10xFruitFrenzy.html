<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<meta name="theme-color" content="#ff6b35" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>Markk's 10x Fruit Frenzy - Razr 2024 Edition</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
  }
  
  html, body {
    width: 100%;
    height: 100vh;
    overflow: hidden;
    position: fixed;
    touch-action: manipulation;
  }
  
  body {
    background: 
      radial-gradient(ellipse at top, #ff9a56 0%, transparent 40%),
      radial-gradient(ellipse at bottom, #c44569 0%, transparent 40%),
      linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 100%);
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    user-select: none;
    overflow: hidden;
    position: relative;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    will-change: transform;
  }

  /* Animated fruit background pattern */
  .fruit-bg-pattern {
    position: fixed;
    width: 200%;
    height: 200%;
    top: -50%;
    left: -50%;
    background-image: 
      repeating-conic-gradient(from 0deg at 50% 50%, 
        transparent 0deg, 
        rgba(255,255,255,0.03) 10deg, 
        transparent 20deg);
    animation: rotateBg 60s linear infinite;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes rotateBg {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* Floating fruit decorations */
  .floating-fruits {
    position: fixed;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
  }

  .floating-fruit {
    position: absolute;
    font-size: 2rem;
    opacity: 0.15;
    animation: floatFruit 20s infinite ease-in-out;
    filter: blur(1px);
  }

  @keyframes floatFruit {
    0%, 100% { 
      transform: translateY(100vh) translateX(0) rotate(0deg);
      opacity: 0;
    }
    10% { opacity: 0.15; }
    90% { opacity: 0.15; }
    50% {
      transform: translateY(-100vh) translateX(100px) rotate(360deg);
    }
  }

  .game-container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 2;
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }
  
  /* Motorola Razr 2024 - 6.9" main display, 2640x1080px */
  .game-header {
    flex: 0 0 auto;
    padding: 12px 16px;
    background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 100%);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.2);
    animation: slideDown 0.5s ease-out;
  }

  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .title-container {
    text-align: center;
    position: relative;
  }

  .game-title {
    font-size: 1.8rem;
    font-weight: 900;
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffa500 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    animation: titleGlow 3s ease-in-out infinite;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  @keyframes titleGlow {
    0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(255,215,0,0.5)); }
    50% { filter: brightness(1.2) drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
  }

  .fruit-icon {
    font-size: 1.6rem;
    animation: bounce 2s ease-in-out infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-5px) rotate(-5deg); }
    75% { transform: translateY(-5px) rotate(5deg); }
  }

  .stats-container {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    margin-top: 10px;
    animation: fadeIn 0.8s ease-out 0.3s backwards;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .stat-box {
    flex: 1;
    padding: 8px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 12px;
    text-align: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .stat-box:active {
    transform: scale(0.98);
  }

  .stat-label {
    font-size: 0.7rem;
    opacity: 0.8;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .stat-value {
    font-size: 1.1rem;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 0 0 10px rgba(255,215,0,0.5);
  }

  .game-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 16px;
    position: relative;
    overflow: hidden;
  }

  .slot-machine {
    width: 100%;
    max-width: 400px;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 
      0 20px 60px rgba(0,0,0,0.5),
      inset 0 1px rgba(255,255,255,0.2);
    position: relative;
    animation: scaleIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.5s backwards;
  }

  @keyframes scaleIn {
    from {
      transform: scale(0.8);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }

  .slot-window {
    background: linear-gradient(135deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%);
    border-radius: 15px;
    padding: 15px;
    position: relative;
    overflow: hidden;
    box-shadow: 
      inset 0 2px 10px rgba(0,0,0,0.8),
      inset 0 -2px 10px rgba(0,0,0,0.8);
  }

  .slot-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 8px;
    position: relative;
  }

  .slot-cell {
    aspect-ratio: 1;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: 2px solid rgba(255,255,255,0.5);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
      0 4px 15px rgba(0,0,0,0.3),
      inset 0 1px rgba(255,255,255,0.3);
    will-change: transform, filter;
  }

  .slot-cell::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
  }

  .slot-cell.spinning {
    animation: slotSpin 0.1s linear infinite;
    filter: blur(2px);
  }

  @keyframes slotSpin {
    0% { transform: translateY(0); }
    100% { transform: translateY(-100%); }
  }

  .slot-cell.winning {
    animation: winPulse 0.5s ease-in-out infinite;
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    border-color: #ffd700;
    box-shadow: 
      0 0 30px rgba(255,215,0,0.8),
      0 4px 15px rgba(0,0,0,0.3),
      inset 0 1px rgba(255,255,255,0.5);
  }

  @keyframes winPulse {
    0%, 100% { 
      transform: scale(1);
      filter: brightness(1);
    }
    50% { 
      transform: scale(1.1);
      filter: brightness(1.3);
    }
  }

  .slot-cell.winning::before {
    left: 100%;
  }

  .win-lines {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 10;
  }

  .win-line {
    stroke: #ffd700;
    stroke-width: 4;
    stroke-linecap: round;
    fill: none;
    filter: drop-shadow(0 0 10px rgba(255,215,0,0.8));
    animation: drawLine 0.5s ease-out;
    stroke-dasharray: 1000;
    stroke-dashoffset: 0;
  }

  @keyframes drawLine {
    from {
      stroke-dashoffset: 1000;
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  .message-display {
    margin-top: 15px;
    padding: 10px;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 10px;
    text-align: center;
    font-size: 0.9rem;
    color: #ffd700;
    font-weight: 600;
    min-height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    animation: messagePulse 2s ease-in-out infinite;
  }

  @keyframes messagePulse {
    0%, 100% { 
      box-shadow: 0 0 10px rgba(255,215,0,0.3);
    }
    50% { 
      box-shadow: 0 0 20px rgba(255,215,0,0.5);
    }
  }

  .controls-container {
    flex: 0 0 auto;
    padding: 16px;
    background: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.3) 100%);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255,255,255,0.2);
    animation: slideUp 0.5s ease-out 0.7s backwards;
  }

  @keyframes slideUp {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .bet-selector {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding: 2px 0;
  }

  .bet-btn {
    flex: 0 0 auto;
    padding: 10px 16px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 12px;
    color: #fff;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
    position: relative;
    overflow: hidden;
  }

  .bet-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transform: translate(-50%, -50%);
    transition: width 0.5s, height 0.5s;
  }

  .bet-btn:active::before {
    width: 200%;
    height: 200%;
  }

  .bet-btn.selected {
    background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
    border-color: #ffd700;
    color: #000;
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255,215,0,0.5);
  }

  .action-buttons {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 10px;
  }

  .btn {
    padding: 14px 20px;
    background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.1) 100%);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 2px solid rgba(255,255,255,0.4);
    border-radius: 15px;
    color: #fff;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .btn-spin {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    border-color: #ff6b35;
    font-size: 1.2rem;
    animation: spinBtnGlow 2s ease-in-out infinite;
  }

  @keyframes spinBtnGlow {
    0%, 100% { 
      box-shadow: 0 0 20px rgba(255,107,53,0.5);
    }
    50% { 
      box-shadow: 0 0 40px rgba(255,107,53,0.8);
    }
  }

  .btn:active {
    transform: scale(0.95);
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    animation: none;
  }

  .btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.4);
    transform: translate(-50%, -50%);
    transition: width 0.5s, height 0.5s;
  }

  .btn:active::after {
    width: 300%;
    height: 300%;
  }

  /* Paytable Modal */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
    animation: modalFadeIn 0.3s ease-out;
  }

  @keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal.show {
    display: flex;
  }

  .modal-content {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 24px;
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    animation: modalSlideIn 0.3s ease-out;
  }

  @keyframes modalSlideIn {
    from {
      transform: translateY(100px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.4);
    color: #fff;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .modal-close:hover {
    background: rgba(255,255,255,0.3);
    transform: rotate(90deg);
  }

  .modal-title {
    text-align: center;
    font-size: 1.5rem;
    font-weight: 900;
    margin-bottom: 20px;
    color: #ffd700;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  .paytable {
    background: rgba(0,0,0,0.3);
    border-radius: 15px;
    padding: 16px;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
  }

  .paytable-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
    margin-bottom: 8px;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
  }

  .paytable-item:hover {
    background: rgba(255,255,255,0.15);
    transform: translateX(5px);
  }

  .paytable-fruit {
    font-size: 1.8rem;
    margin-right: 12px;
  }

  .paytable-info {
    flex: 1;
    font-size: 0.9rem;
    color: rgba(255,255,255,0.9);
  }

  .paytable-payout {
    font-size: 1rem;
    font-weight: bold;
    color: #ffd700;
    text-align: right;
  }

  /* Particle effects container */
  .particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 999;
  }

  .particle {
    position: absolute;
    pointer-events: none;
    animation: particleFloat 2s ease-out forwards;
  }

  @keyframes particleFloat {
    0% {
      transform: translateY(0) scale(1) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(-100px) scale(0) rotate(360deg);
      opacity: 0;
    }
  }

  /* Responsive adjustments for Motorola Razr 2024 */
  @media (max-width: 412px) and (min-height: 915px) {
    .game-title {
      font-size: 1.5rem;
    }
    
    .slot-cell {
      font-size: 2rem;
    }
    
    .slot-grid {
      gap: 6px;
    }
    
    .btn {
      padding: 12px 16px;
      font-size: 0.9rem;
    }
  }

  /* Landscape mode */
  @media (orientation: landscape) {
    .game-container {
      flex-direction: row;
    }
    
    .game-header {
      writing-mode: vertical-lr;
      flex: 0 0 auto;
      width: auto;
      border-bottom: none;
      border-right: 1px solid rgba(255,255,255,0.2);
    }
    
    .controls-container {
      flex: 0 0 200px;
      border-top: none;
      border-left: 1px solid rgba(255,255,255,0.2);
    }
  }

  /* Performance optimizations */
  .hardware-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }

  /* Smooth scrolling */
  * {
    scroll-behavior: smooth;
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
</head>
<body>

<div class="fruit-bg-pattern"></div>

<div class="floating-fruits">
  <span class="floating-fruit" style="left: 10%; animation-delay: 0s;">🍎</span>
  <span class="floating-fruit" style="left: 25%; animation-delay: 3s;">🍊</span>
  <span class="floating-fruit" style="left: 40%; animation-delay: 6s;">🍇</span>
  <span class="floating-fruit" style="left: 55%; animation-delay: 9s;">🍓</span>
  <span class="floating-fruit" style="left: 70%; animation-delay: 12s;">🍌</span>
  <span class="floating-fruit" style="left: 85%; animation-delay: 15s;">🍉</span>
</div>

<div class="game-container">
  <div class="game-header">
    <div class="title-container">
      <h1 class="game-title">
        <span class="fruit-icon">🍎</span>
        <span>10x Fruit Frenzy</span>
        <span class="fruit-icon">🍊</span>
      </h1>
    </div>
    <div class="stats-container">
      <div class="stat-box">
        <div class="stat-label">Balance</div>
        <div class="stat-value" id="balance">$0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Total Won</div>
        <div class="stat-value" id="total-won">$0</div>
      </div>
    </div>
  </div>

  <div class="game-main">
    <div class="slot-machine hardware-accelerated">
      <div class="slot-window">
        <div class="slot-grid" id="slot-grid"></div>
        <svg class="win-lines" id="win-lines"></svg>
      </div>
      <div class="message-display" id="message">
        🍎 Welcome to Fruit Frenzy! 🍊
      </div>
    </div>
  </div>

  <div class="controls-container">
    <div class="bet-selector" id="bet-selector">
      <button class="bet-btn" data-bet="1">$1</button>
      <button class="bet-btn selected" data-bet="10">$10</button>
      <button class="bet-btn" data-bet="20">$20</button>
      <button class="bet-btn" data-bet="30">$30</button>
      <button class="bet-btn" data-bet="40">$40</button>
      <button class="bet-btn" data-bet="50">$50</button>
    </div>
    <div class="action-buttons">
      <button class="btn btn-spin" id="spin-btn">🎰 SPIN</button>
      <button class="btn" id="paytable-btn">📋 PAY</button>
      <button class="btn" id="exit-btn">🚪 EXIT</button>
    </div>
  </div>
</div>

<div class="modal" id="paytable-modal">
  <div class="modal-content">
    <button class="modal-close" id="modal-close">✕</button>
    <h2 class="modal-title">🍎 Fruit Payouts 🍊</h2>
    <div class="paytable">
      <div class="paytable-item">
        <span class="paytable-fruit">🍎</span>
        <span class="paytable-info">Red Apple - Common Fruit</span>
        <span class="paytable-payout">1-3x</span>
      </div>
      <div class="paytable-item">
        <span class="paytable-fruit">🍏</span>
        <span class="paytable-info">Green Apple - Common Fruit</span>
        <span class="paytable-payout">1-3x</span>
      </div>
      <div class="paytable-item">
        <span class="paytable-fruit">🍊</span>
        <span class="paytable-info">Orange - Medium Fruit</span>
        <span class="paytable-payout">5-20x</span>
      </div>
      <div class="paytable-item">
        <span class="paytable-fruit">🍋</span>
        <span class="paytable-info">Lemon - Medium Fruit</span>
        <span class="paytable-payout">5-20x</span>
      </div>
      <div class="paytable-item">
        <span class="paytable-fruit">🍇</span>
        <span class="paytable-info">Grapes - Rare Fruit</span>
        <span class="paytable-payout">8-16x</span>
      </div>
      <div class="paytable-item">
        <span class="paytable-fruit">🍓</span>
        <span class="paytable-info">Strawberry - Rare Fruit</span>
        <span class="paytable-payout">8-16x</span>
      </div>
      <div class="paytable-item">
        <span class="paytable-fruit">🍉</span>
        <span class="paytable-info">Watermelon - Jackpot Fruit</span>
        <span class="paytable-payout">25x</span>
      </div>
      <div class="paytable-item">
        <span class="paytable-fruit">🍒</span>
        <span class="paytable-info">Cherry - Bonus Fruit</span>
        <span class="paytable-payout">Free Spins</span>
      </div>
    </div>
  </div>
</div>

<div class="particles" id="particles"></div>

<script>
(() => {
  'use strict';

  // Game configuration
  const ROWS = 3;
  const COLS = 5;
  const SPIN_DURATION = 2000;
  const REEL_DELAY = 200;
  
  // Fruit symbols with weights
  const FRUITS = [
    { symbol: '🍎', weight: 15, name: 'Apple' },
    { symbol: '🍏', weight: 15, name: 'Green Apple' },
    { symbol: '🍊', weight: 12, name: 'Orange' },
    { symbol: '🍋', weight: 12, name: 'Lemon' },
    { symbol: '🍇', weight: 8, name: 'Grapes' },
    { symbol: '🍓', weight: 8, name: 'Strawberry' },
    { symbol: '🍌', weight: 8, name: 'Banana' },
    { symbol: '🍍', weight: 6, name: 'Pineapple' },
    { symbol: '🥭', weight: 5, name: 'Mango' },
    { symbol: '🍑', weight: 5, name: 'Peach' },
    { symbol: '🍉', weight: 3, name: 'Watermelon' },
    { symbol: '🍒', weight: 3, name: 'Cherry' }
  ];

  // Create weighted fruit array
  const weightedFruits = [];
  FRUITS.forEach(fruit => {
    for (let i = 0; i < fruit.weight; i++) {
      weightedFruits.push(fruit.symbol);
    }
  });

  // Payout table
  const PAYOUTS = {
    '🍎': { 1: 1, 2: 2, 3: 3 },
    '🍏': { 1: 1, 2: 2, 3: 3 },
    '🍊': { 3: 5, 4: 10, 5: 20 },
    '🍋': { 3: 5, 4: 10, 5: 20 },
    '🍇': { 4: 8, 5: 16 },
    '🍓': { 4: 8, 5: 16 },
    '🍌': { 4: 8, 5: 16 },
    '🍍': { 4: 10, 5: 20 },
    '🥭': { 4: 10, 5: 20 },
    '🍑': { 4: 10, 5: 20 },
    '🍉': { 5: 25 },
    '🍒': { 3: 5, 5: 10 } // Bonus
  };

  // Game state
  let balance = 0;
  let totalWon = 0;
  let currentBet = 10;
  let isSpinning = false;
  let grid = [];
  let audioContext = null;
  let audioBuffers = {};

  // DOM elements
  const balanceEl = document.getElementById('balance');
  const totalWonEl = document.getElementById('total-won');
  const messageEl = document.getElementById('message');
  const slotGridEl = document.getElementById('slot-grid');
  const winLinesEl = document.getElementById('win-lines');
  const spinBtn = document.getElementById('spin-btn');
  const paytableBtn = document.getElementById('paytable-btn');
  const exitBtn = document.getElementById('exit-btn');
  const betSelector = document.getElementById('bet-selector');
  const paytableModal = document.getElementById('paytable-modal');
  const modalClose = document.getElementById('modal-close');
  const particlesEl = document.getElementById('particles');

  // Initialize audio context
  function initAudio() {
    if (!audioContext) {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioContext.state === 'suspended') {
      audioContext.resume();
    }
  }

  // Sound effects using Web Audio API
  function playSound(type) {
    initAudio();
    if (!audioContext) return;

    const now = audioContext.currentTime;
    const gainNode = audioContext.createGain();
    gainNode.connect(audioContext.destination);

    switch(type) {
      case 'spin':
        // Spinning sound - ascending frequencies
        for (let i = 0; i < 8; i++) {
          const osc = audioContext.createOscillator();
          osc.connect(gainNode);
          osc.frequency.value = 200 + (i * 50);
          osc.type = 'sine';
          gainNode.gain.setValueAtTime(0.1, now + i * 0.05);
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + i * 0.05 + 0.1);
          osc.start(now + i * 0.05);
          osc.stop(now + i * 0.05 + 0.1);
        }
        break;

      case 'stop':
        // Reel stop sound
        const stopOsc = audioContext.createOscillator();
        stopOsc.connect(gainNode);
        stopOsc.frequency.value = 150;
        stopOsc.type = 'square';
        gainNode.gain.setValueAtTime(0.2, now);
        gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.15);
        stopOsc.start(now);
        stopOsc.stop(now + 0.15);
        break;

      case 'win':
        // Win jingle - major chord arpeggio
        const winFreqs = [261.63, 329.63, 392.00, 523.25]; // C major
        winFreqs.forEach((freq, i) => {
          const osc = audioContext.createOscillator();
          osc.connect(gainNode);
          osc.frequency.value = freq;
          osc.type = 'sine';
          gainNode.gain.setValueAtTime(0.2, now + i * 0.1);
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.4);
          osc.start(now + i * 0.1);
          osc.stop(now + i * 0.1 + 0.4);
        });
        break;

      case 'bigwin':
        // Big win fanfare
        for (let i = 0; i < 12; i++) {
          const osc = audioContext.createOscillator();
          osc.connect(gainNode);
          osc.frequency.value = 400 + (i * 100);
          osc.type = 'triangle';
          gainNode.gain.setValueAtTime(0.15, now + i * 0.08);
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + i * 0.08 + 0.3);
          osc.start(now + i * 0.08);
          osc.stop(now + i * 0.08 + 0.3);
        }
        break;

      case 'click':
        // Button click
        const clickOsc = audioContext.createOscillator();
        clickOsc.connect(gainNode);
        clickOsc.frequency.value = 800;
        clickOsc.type = 'sine';
        gainNode.gain.setValueAtTime(0.1, now);
        gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
        clickOsc.start(now);
        clickOsc.stop(now + 0.05);
        break;
    }
  }

  // Initialize grid
  function initGrid() {
    slotGridEl.innerHTML = '';
    grid = [];
    
    for (let row = 0; row < ROWS; row++) {
      const rowArr = [];
      for (let col = 0; col < COLS; col++) {
        const cell = document.createElement('div');
        cell.className = 'slot-cell hardware-accelerated';
        cell.textContent = '❓';
        cell.dataset.row = row;
        cell.dataset.col = col;
        slotGridEl.appendChild(cell);
        rowArr.push(cell);
      }
      grid.push(rowArr);
    }
  }

  // Get random fruit
  function getRandomFruit() {
    return weightedFruits[Math.floor(Math.random() * weightedFruits.length)];
  }

  // Create particle effect
  function createParticle(x, y, emoji) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.textContent = emoji;
    particle.style.left = x + 'px';
    particle.style.top = y + 'px';
    particle.style.fontSize = '2rem';
    particlesEl.appendChild(particle);
    
    setTimeout(() => {
      particle.remove();
    }, 2000);
  }

  // Spin animation for single reel
  async function spinReel(col) {
    const spinCount = 15 + Math.floor(Math.random() * 10);
    const cells = [];
    
    for (let row = 0; row < ROWS; row++) {
      cells.push(grid[row][col]);
      grid[row][col].classList.add('spinning');
    }
    
    for (let i = 0; i < spinCount; i++) {
      for (let row = 0; row < ROWS; row++) {
        grid[row][col].textContent = getRandomFruit();
      }
      await new Promise(resolve => setTimeout(resolve, 50));
    }
    
    // Set final values
    for (let row = 0; row < ROWS; row++) {
      grid[row][col].textContent = getRandomFruit();
      grid[row][col].classList.remove('spinning');
    }
    
    playSound('stop');
  }

  // Main spin function
  async function spin() {
    if (isSpinning) return;
    if (currentBet > balance) {
      showMessage('⚠️ Insufficient balance!');
      shakeElement(balanceEl.parentElement);
      return;
    }
    
    isSpinning = true;
    spinBtn.disabled = true;
    clearWinnings();
    
    // Deduct bet
    balance -= currentBet;
    updateDisplay();
    
    showMessage('🎰 Spinning the fruit reels...');
    playSound('spin');
    
    // Spin each reel with delay
    for (let col = 0; col < COLS; col++) {
      setTimeout(() => spinReel(col), col * REEL_DELAY);
    }
    
    // Wait for all reels to stop
    await new Promise(resolve => setTimeout(resolve, SPIN_DURATION + (COLS * REEL_DELAY)));
    
    // Check for wins
    checkWins();
    
    isSpinning = false;
    spinBtn.disabled = false;
    
    saveGameState();
  }

  // Check for winning combinations
  function checkWins() {
    const results = [];
    for (let row = 0; row < ROWS; row++) {
      const rowResult = [];
      for (let col = 0; col < COLS; col++) {
        rowResult.push(grid[row][col].textContent);
      }
      results.push(rowResult);
    }
    
    let totalWin = 0;
    const winningCells = [];
    
    // Check each row for wins
    for (let row = 0; row < ROWS; row++) {
      let currentFruit = null;
      let count = 0;
      let startCol = 0;
      
      for (let col = 0; col <= COLS; col++) {
        const fruit = col < COLS ? results[row][col] : null;
        
        if (fruit === currentFruit && col < COLS) {
          count++;
        } else {
          // Check if we have a winning combination
          if (currentFruit && PAYOUTS[currentFruit]) {
            const payout = PAYOUTS[currentFruit][count];
            if (payout) {
              const winAmount = payout * currentBet;
              totalWin += winAmount;
              
              // Mark winning cells
              for (let i = startCol; i < startCol + count; i++) {
                winningCells.push({ row, col: i });
              }
            }
          }
          
          // Start new sequence
          currentFruit = fruit;
          count = 1;
          startCol = col;
        }
      }
    }
    
    // Process wins
    if (totalWin > 0) {
      balance += totalWin;
      totalWon += totalWin;
      
      // Highlight winning cells
      winningCells.forEach(cell => {
        grid[cell.row][cell.col].classList.add('winning');
        const rect = grid[cell.row][cell.col].getBoundingClientRect();
        createParticle(rect.left + rect.width/2, rect.top + rect.height/2, '✨');
      });
      
      // Draw win lines
      drawWinLines(winningCells);
      
      // Play appropriate sound
      if (totalWin >= currentBet * 10) {
        playSound('bigwin');
        showMessage(`🎉 BIG FRUIT WIN! $${totalWin}! 🎉`);
      } else {
        playSound('win');
        showMessage(`🍎 Fruit Win! $${totalWin}! 🍊`);
      }
    } else {
      showMessage('No fruit matches. Try again!');
    }
    
    updateDisplay();
  }

  // Draw win lines
  function drawWinLines(winningCells) {
    winLinesEl.innerHTML = '';
    
    // Group cells by row
    const rows = {};
    winningCells.forEach(cell => {
      if (!rows[cell.row]) rows[cell.row] = [];
      rows[cell.row].push(cell.col);
    });
    
    // Draw lines for each row
    Object.keys(rows).forEach(row => {
      const cols = rows[row].sort((a, b) => a - b);
      if (cols.length < 2) return;
      
      const firstCell = grid[row][cols[0]];
      const lastCell = grid[row][cols[cols.length - 1]];
      
      const rect1 = firstCell.getBoundingClientRect();
      const rect2 = lastCell.getBoundingClientRect();
      const svgRect = winLinesEl.getBoundingClientRect();
      
      const x1 = rect1.left + rect1.width / 2 - svgRect.left;
      const y1 = rect1.top + rect1.height / 2 - svgRect.top;
      const x2 = rect2.left + rect2.width / 2 - svgRect.left;
      const y2 = rect2.top + rect2.height / 2 - svgRect.top;
      
      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', x1);
      line.setAttribute('y1', y1);
      line.setAttribute('x2', x2);
      line.setAttribute('y2', y2);
      line.classList.add('win-line');
      
      winLinesEl.appendChild(line);
    });
  }

  // Clear winning highlights
  function clearWinnings() {
    grid.forEach(row => {
      row.forEach(cell => {
        cell.classList.remove('winning');
      });
    });
    winLinesEl.innerHTML = '';
  }

  // Show message
  function showMessage(msg) {
    messageEl.textContent = msg;
    messageEl.style.animation = 'none';
    setTimeout(() => {
      messageEl.style.animation = '';
    }, 10);
  }

  // Shake element animation
  function shakeElement(element) {
    element.style.animation = 'none';
    setTimeout(() => {
      element.style.animation = 'shake 0.5s';
    }, 10);
  }

  // Update display
  function updateDisplay() {
    balanceEl.textContent = `$${balance}`;
    totalWonEl.textContent = `$${totalWon}`;
  }

  // Save game state
  function saveGameState() {
    localStorage.setItem('localPlayerCash', balance);
    localStorage.setItem('fruitFrenzyTotalWon', totalWon);
  }

  // Load game state
  function loadGameState() {
    balance = parseInt(localStorage.getItem('localPlayerCash')) || 0;
    totalWon = parseInt(localStorage.getItem('fruitFrenzyTotalWon')) || 0;
    updateDisplay();
  }

  // Handle bet selection
  betSelector.addEventListener('click', (e) => {
    if (!e.target.classList.contains('bet-btn')) return;
    
    playSound('click');
    
    document.querySelectorAll('.bet-btn').forEach(btn => {
      btn.classList.remove('selected');
    });
    
    e.target.classList.add('selected');
    currentBet = parseInt(e.target.dataset.bet);
  });

  // Handle spin button
  spinBtn.addEventListener('click', () => {
    playSound('click');
    spin();
  });

  // Handle paytable button
  paytableBtn.addEventListener('click', () => {
    playSound('click');
    paytableModal.classList.add('show');
  });

  // Handle modal close
  modalClose.addEventListener('click', () => {
    playSound('click');
    paytableModal.classList.remove('show');
  });

  paytableModal.addEventListener('click', (e) => {
    if (e.target === paytableModal) {
      playSound('click');
      paytableModal.classList.remove('show');
    }
  });

  // Handle exit button
  exitBtn.addEventListener('click', () => {
    playSound('click');
    if (balance >= 5) {
      balance -= 5;
      saveGameState();
      window.location.href = '../index.html';
    } else {
      showMessage('⚠️ Need $5 to exit!');
      shakeElement(exitBtn);
    }
  });

  // Add shake animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
  `;
  document.head.appendChild(style);

  // Initialize audio on first interaction
  document.addEventListener('click', initAudio, { once: true });
  document.addEventListener('touchstart', initAudio, { once: true });

  // Prevent double-tap zoom on mobile
  let lastTouchTime = 0;
  document.addEventListener('touchstart', (e) => {
    const currentTime = new Date().getTime();
    if (currentTime - lastTouchTime < 300) {
      e.preventDefault();
    }
    lastTouchTime = currentTime;
  });

  // Handle visibility change for performance
  document.addEventListener('visibilitychange', () => {
    if (document.hidden && audioContext) {
      audioContext.suspend();
    } else if (!document.hidden && audioContext) {
      audioContext.resume();
    }
  });

  // Initialize game
  function init() {
    initGrid();
    loadGameState();
    showMessage('🍎 Welcome to Fruit Frenzy! 🍊');
    
    // Add initial fruits to grid
    for (let row = 0; row < ROWS; row++) {
      for (let col = 0; col < COLS; col++) {
        grid[row][col].textContent = getRandomFruit();
      }
    }
  }

  // Start game
  init();

})();
</script>

</body>
</html>