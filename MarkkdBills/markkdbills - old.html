<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<title>Markk'dBills Slot Machine</title>
<style>
  html, body {
    max-width: 100vw;
    overflow-x: hidden;
  }
  
  body {
    background: 
      radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(0, 255, 136, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, rgba(128, 128, 128, 0.1) 0%, transparent 50%),
      linear-gradient(135deg, #000000 0%, #0a0a0a 25%, #1a1a1a 50%, #0a0a0a 75%, #000000 100%);
    background-attachment: fixed;
    color: #ffffff;
    font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    margin: 0; 
    padding: 0;
    user-select: none;
    overflow-x: hidden;
    max-width: 100vw;
    position: relative;
    min-height: 100vh;
    font-weight: 400;
    letter-spacing: -0.01em;
    overscroll-behavior: none;
  }

  /* Money particles background */
  #moneyParticles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
  }

  .money-particle {
    position: absolute;
    font-size: 1.2rem;
    animation: floatMoney 8s linear infinite;
    opacity: 0.6;
    user-select: none;
    will-change: transform, opacity;
    filter: drop-shadow(0 0 8px rgba(0, 255, 136, 0.4));
    color: #00ff88;
  }

  @keyframes floatMoney {
    0% { 
      transform: translateY(100vh) translateX(0) rotate(0deg); 
      opacity: 0; 
    }
    10% { 
      opacity: 0.6; 
    }
    90% { 
      opacity: 0.6; 
    }
    100% { 
      transform: translateY(-10vh) translateX(20px) rotate(360deg); 
      opacity: 0; 
    }
  }

  /* iPhone Game Container */
  .game-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 30px;
  }
  
  /* Respect safe areas on modern mobile devices */
  @supports (padding: max(0px)) {
    .game-container {
      padding-top: max(20px, env(safe-area-inset-top));
      padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
  }
  
  h1 {
    text-align: center;
    color: #ffffff;
    font-size: clamp(1.8rem, 6vw, 3.2rem);
    font-weight: 800;
    letter-spacing: -0.02em;
    background: linear-gradient(135deg, #ffffff 0%, #00ff88 50%, #ffffff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
    text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
    animation: titleGlow 3s ease-in-out infinite alternate;
  }

  @keyframes titleGlow {
    0% { filter: brightness(1); }
    100% { filter: brightness(1.2); }
  }

  h1::after {
    content: 'üé∞';
    position: absolute;
    top: -20px;
    right: -60px;
    font-size: 0.4em;
    animation: slotSpin 2s linear infinite;
  }

  @keyframes slotSpin {
    0% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.1); }
    100% { transform: rotate(360deg) scale(1); }
  }

  /* Game stats panel */
  .game-stats {
    display: flex;
    gap: 40px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 600px;
  }
  
  #walletDisplay {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
    border: 2px solid rgba(0, 255, 136, 0.3);
    border-radius: 20px;
    padding: 25px 35px;
    backdrop-filter: blur(25px);
    box-shadow: 
      0 15px 50px rgba(0, 255, 136, 0.2),
      inset 0 2px 0 rgba(255, 255, 255, 0.2);
    color: #ffffff;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-align: center;
    min-width: 250px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  #walletDisplay::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }

  #walletDisplay:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 
      0 20px 60px rgba(0, 255, 136, 0.3),
      inset 0 2px 0 rgba(255, 255, 255, 0.3);
    border-color: rgba(0, 255, 136, 0.5);
  }

  #walletDisplay:hover::before {
    left: 100%;
  }

  #freeSpinCounter {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
    border: 2px solid rgba(0, 255, 136, 0.3);
    border-radius: 20px;
    padding: 25px 35px;
    backdrop-filter: blur(25px);
    box-shadow: 
      0 15px 50px rgba(0, 255, 136, 0.2),
      inset 0 2px 0 rgba(255, 255, 255, 0.2);
    color: #00ff88;
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-align: center;
    min-width: 250px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    animation: freeSpinPulse 2s ease-in-out infinite;
  }

  @keyframes freeSpinPulse {
    0%, 100% { 
      transform: scale(1);
      box-shadow: 
        0 15px 50px rgba(0, 255, 136, 0.2),
        inset 0 2px 0 rgba(255, 255, 255, 0.2);
    }
    50% { 
      transform: scale(1.02);
      box-shadow: 
        0 20px 60px rgba(0, 255, 136, 0.3),
        inset 0 2px 0 rgba(255, 255, 255, 0.3);
    }
  }

  #freeSpinCounter::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }

  #freeSpinCounter:hover::before {
    left: 100%;
  }
  
  #betSelector {
    background: rgba(128, 128, 128, 0.15);
    border: 2px solid rgba(128, 128, 128, 0.3);
    border-radius: 25px;
    padding: 30px;
    backdrop-filter: blur(25px);
    box-shadow: 
      0 15px 50px rgba(0, 0, 0, 0.3),
      inset 0 2px 0 rgba(255, 255, 255, 0.1);
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 15px;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }
  
  #betSelector button {
    background: linear-gradient(135deg, rgba(128, 128, 128, 0.25), rgba(128, 128, 128, 0.15));
    border: 2px solid rgba(128, 128, 128, 0.4);
    color: #ffffff;
    padding: 15px 20px;
    font-weight: 700;
    font-size: 1.2rem;
    cursor: pointer;
    border-radius: 15px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    width: 100%;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #betSelector button:hover {
    transform: translateY(-3px) scale(1.03);
    background: linear-gradient(135deg, rgba(128, 128, 128, 0.35), rgba(128, 128, 128, 0.25));
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
    border-color: rgba(128, 128, 128, 0.6);
  }

  #betSelector button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }

  #betSelector button:hover::before {
    left: 100%;
  }

  #betSelector button:active {
    transform: translateY(-2px) scale(1.02);
  }
  
  #betSelector button.selected {
    background: linear-gradient(135deg, #00ff88, #00cc66);
    color: #000000;
    box-shadow: 
      0 12px 35px rgba(0, 255, 136, 0.4),
      inset 0 2px 0 rgba(255, 255, 255, 0.3);
    transform: translateY(-3px) scale(1.03);
    border-color: rgba(0, 255, 136, 0.6);
    animation: selectedPulse 2s ease-in-out infinite;
  }

  @keyframes selectedPulse {
    0%, 100% { 
      box-shadow: 
        0 15px 40px rgba(0, 255, 136, 0.4),
        inset 0 2px 0 rgba(255, 255, 255, 0.3);
    }
    50% { 
      box-shadow: 
        0 20px 50px rgba(0, 255, 136, 0.6),
        inset 0 2px 0 rgba(255, 255, 255, 0.4);
    }
  }
  
  #slotContainer {
    position: relative;
    width: 500px;
    max-width: 95vw;
    box-sizing: border-box;
    background: rgba(128, 128, 128, 0.1);
    border: 3px solid rgba(128, 128, 128, 0.2);
    border-radius: 30px;
    padding: 40px;
    backdrop-filter: blur(25px);
    box-shadow: 
      0 25px 80px rgba(0, 0, 0, 0.4),
      inset 0 2px 0 rgba(255, 255, 255, 0.1);
    transition: all 0.4s ease;
    margin: 0 auto;
  }

  #slotContainer:hover {
    transform: translateY(-5px);
    box-shadow: 
      0 30px 100px rgba(0, 0, 0, 0.5),
      inset 0 2px 0 rgba(255, 255, 255, 0.2);
  }
  
  @media (max-width: 480px) {
    .game-container {
      padding: 12px;
      gap: 16px;
    }
    .game-stats {
      gap: 12px;
    }
    #walletDisplay,
    #freeSpinCounter {
      min-width: 0;
      width: 100%;
      padding: 16px 20px;
      font-size: 1.2rem;
    }
    #betSelector {
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 16px;
      max-width: 100%;
    }
    #betSelector button {
      min-height: 48px;
      font-size: 1rem;
      padding: 12px 16px;
    }
    #slotContainer {
      width: min(95vw, 360px);
      padding: 12px;
    }
    #slotGrid {
      gap: 6px;
    }
    .slotCell {
      font-size: clamp(1.6rem, 6vw, 2.4rem);
    }
    #spinBtn {
      padding: 18px 28px;
      min-width: 220px;
      font-size: 1.2rem;
      border-radius: 18px;
    }
    #message {
      font-size: 1rem;
      padding: 16px 20px;
    }
    #payTableContainer {
      padding: 16px;
      max-height: 45vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    #payTableContainer table {
      min-width: 360px;
      font-size: 0.85em;
    }
    #payTableContainer thead th {
      position: sticky;
      top: 0;
      background: #ffffff;
      z-index: 1;
    }
  }
  
  #slotGrid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 8px;
    justify-content: center;
    max-width: 100%;
  }
  
  .slotCell {
    background: linear-gradient(135deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.1));
    border: 2px solid rgba(128, 128, 128, 0.3);
    border-radius: 20px;
    font-size: clamp(2.5em, 5vw, 3.5em);
    line-height: 1;
    text-align: center;
    user-select: none;
    box-shadow: 
      0 8px 30px rgba(0, 0, 0, 0.3),
      inset 0 2px 0 rgba(255, 255, 255, 0.2);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 1;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(15px);
    overflow: hidden;
  }

  .slotCell:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
      0 12px 40px rgba(0, 0, 0, 0.4),
      inset 0 2px 0 rgba(255, 255, 255, 0.3);
    border-color: rgba(128, 128, 128, 0.5);
  }

  .slotCell.spinning {
    animation: cellSpin 0.1s linear infinite;
  }

  @keyframes cellSpin {
    0% { transform: rotateY(0deg); }
    100% { transform: rotateY(360deg); }
  }
  
  .winning {
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 255, 136, 0.4));
    border-color: #00ff88;
    box-shadow: 
      0 0 30px rgba(0, 255, 136, 0.6),
      0 8px 30px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    animation: winPulse 0.8s ease-in-out infinite alternate;
  }

  @keyframes winPulse {
    0% { 
      transform: scale(1);
      box-shadow: 
        0 0 30px rgba(0, 255, 136, 0.6),
        0 8px 30px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    100% { 
      transform: scale(1.02);
      box-shadow: 
        0 0 50px rgba(0, 255, 136, 0.8),
        0 12px 40px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
  }
  
  #linesSvg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 2;
  }
  
  @keyframes wiggleGlow {
    0% {
      stroke: #00ff88;
      stroke-width: 4;
      filter: drop-shadow(0 0 5px #00ff88);
      transform: translate(0,0) rotate(0deg);
      opacity: 0.9;
    }
    25% {
      stroke-width: 5;
      filter: drop-shadow(0 0 10px #00ff88);
      transform: translate(-1px, 1px) rotate(-1deg);
      opacity: 1;
    }
    50% {
      stroke-width: 4;
      filter: drop-shadow(0 0 5px #00ff88);
      transform: translate(1px, -1px) rotate(1deg);
      opacity: 0.9;
    }
    75% {
      stroke-width: 5;
      filter: drop-shadow(0 0 10px #00ff88);
      transform: translate(-1px, 0px) rotate(-0.5deg);
      opacity: 1;
    }
    100% {
      stroke-width: 4;
      filter: drop-shadow(0 0 5px #00ff88);
      transform: translate(0,0) rotate(0deg);
      opacity: 0.9;
    }
  }

  .winLine {
    stroke: #00ff88;
    stroke-width: 4;
    stroke-linecap: round;
    opacity: 0.9;
    animation: wiggleGlow 1s infinite ease-in-out;
    transform-origin: center;
  }

  #spinBtn {
    display: block;
    margin: 0 auto;
    background: linear-gradient(135deg, #00ff88, #00cc66, #00ff88);
    background-size: 200% 200%;
    animation: buttonGradient 3s ease-in-out infinite;
    color: #000000;
    font-weight: 800;
    font-size: 1.8rem;
    padding: 25px 60px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    box-shadow: 
      0 15px 50px rgba(0, 255, 136, 0.4),
      inset 0 2px 0 rgba(255, 255, 255, 0.3);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    letter-spacing: 2px;
    min-width: 250px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  @keyframes buttonGradient {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  #spinBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s ease;
  }

  #spinBtn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 20px 60px rgba(0, 255, 136, 0.5),
      inset 0 2px 0 rgba(255, 255, 255, 0.4);
  }

  #spinBtn:hover::before {
    left: 100%;
  }

  #spinBtn:active {
    transform: translateY(-2px) scale(1.02);
  }
  
  #spinBtn:disabled {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.5);
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
    animation: none;
  }
  
  #message {
    text-align: center;
    font-size: 1.5rem;
    min-height: 2em;
    color: #ffffff;
    background: linear-gradient(135deg, rgba(128, 128, 128, 0.1), rgba(128, 128, 128, 0.05));
    border: 2px solid rgba(128, 128, 128, 0.2);
    border-radius: 20px;
    padding: 25px 35px;
    backdrop-filter: blur(25px);
    box-shadow: 
      0 15px 50px rgba(0, 0, 0, 0.3),
      inset 0 2px 0 rgba(255, 255, 255, 0.1);
    font-weight: 700;
    letter-spacing: 1px;
    position: relative;
    overflow: hidden;
    max-width: 600px;
    margin: 0 auto;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  #payTableContainer {
    background: #ffffff;
    border: 2px solid #000000;
    padding: 25px;
    border-radius: 0;
    margin: 30px auto;
    max-width: 100%;
    overflow-x: auto;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    display: block;
    visibility: visible;
    position: relative;
    font-family: 'Courier New', monospace;
    color: #000000;
    background-image: repeating-linear-gradient(180deg, rgba(0,0,0,0.06) 0px, rgba(0,0,0,0.06) 1px, transparent 1px, transparent 28px);
  }

  #payTableContainer::before {
    content: 'RECEIPT';
    position: absolute;
    top: -15px;
    left: 20px;
    background: #ffffff;
    padding: 0 10px;
    font-size: 12px;
    font-weight: bold;
    color: #000000;
    letter-spacing: 2px;
  }

  #payTableContainer::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: repeating-linear-gradient(
      90deg,
      #000000 0px,
      #000000 10px,
      transparent 10px,
      transparent 20px
    );
    box-shadow: 0 10px 0 #ffffff inset;
  }
  
  #payTableContainer table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95em;
    min-width: 400px;
    font-family: 'Courier New', monospace;
  }
  
  #payTableContainer th, #payTableContainer td {
    border: none;
    border-bottom: 1px solid #000000;
    padding: 10px 6px;
    text-align: left;
    background: transparent;
    color: #000000;
    font-size: 0.9em;
  }
  
  #payTableContainer th {
    background: transparent;
    color: #000000;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 2px solid #000000;
  }

  #payTableContainer tr:hover {
    background: rgba(0, 255, 136, 0.1);
  }
  
  a {
    color: #00ff88;
    text-decoration: none;
    background: rgba(0, 255, 136, 0.12);
    border: 2px solid #00ff88;
    border-radius: 12px;
    padding: 12px 20px;
    display: inline-block;
    margin: 12px;
    transition: all 0.3s ease;
    text-shadow: 0 0 5px #00ff88;
    box-shadow: 0 0 15px rgba(0, 255, 136, 0.25);
  }

  a:hover {
    background: rgba(0, 255, 136, 0.22);
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0, 255, 136, 0.45);
  }
  
  #freeSpinCounter {
    text-align: center;
    font-size: 1.3em;
    margin-bottom: 20px;
    color: #00ff88;
    text-shadow: 0 0 10px #00ff88, 0 0 20px #00ff88;
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.4));
    border: 2px solid #00ff88;
    border-radius: 15px;
    padding: 15px;
    backdrop-filter: blur(10px);
    box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    font-weight: bold;
    letter-spacing: 1px;
    animation: freeSpinPulse 2s ease-in-out infinite;
  }

  @keyframes freeSpinPulse {
    0%, 100% { 
      transform: scale(1);
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    }
    50% { 
      transform: scale(1.02);
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
    }
  }

  @keyframes bigWinFlash {
    0% { 
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%, #000000 100%);
    }
    25% { 
      background: linear-gradient(135deg, #00ff88 0%, #00cc66 25%, #00ff88 50%, #00cc66 75%, #00ff88 100%);
    }
    50% { 
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%, #000000 100%);
    }
    75% { 
      background: linear-gradient(135deg, #00ff88 0%, #00cc66 25%, #00ff88 50%, #00cc66 75%, #00ff88 100%);
    }
    100% { 
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%, #000000 100%);
    }
  }

  /* =============================
     New Mobile-First Theme Override
     ============================= */
  :root {
    --bg-0: #0b1020; /* deep navy */
    --bg-1: #10162a; /* indigo night */
    --bg-2: #0e1330; /* darker */
    --text-primary: #ffffff;
    --text-secondary: #c9cdd8;
    --accent: #ffd166; /* gold */
    --accent-strong: #ffb703; /* rich amber */
    --accent-soft: rgba(255, 209, 102, 0.18);
    --card-bg: rgba(255, 255, 255, 0.06);
    --border-subtle: rgba(255, 255, 255, 0.14);
    --shadow-soft: 0 16px 40px rgba(0,0,0,0.45);
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bg-0: #f8fafc;
      --bg-1: #eef2f7;
      --bg-2: #e9eef6;
      --text-primary: #101524;
      --text-secondary: #3c4154;
      --card-bg: rgba(16, 21, 36, 0.05);
      --border-subtle: rgba(16, 21, 36, 0.12);
      --shadow-soft: 0 10px 24px rgba(16,21,36,0.15);
    }
  }

  html, body {
    background: radial-gradient(1200px 800px at 10% 10%, var(--bg-1), transparent 60%),
                radial-gradient(1000px 700px at 90% 20%, var(--bg-2), transparent 55%),
                linear-gradient(180deg, var(--bg-0), var(--bg-2));
    color: var(--text-primary);
  }

  body {
    min-height: 100dvh;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  /* Floating money particles color shift to gold */
  .money-particle {
    color: var(--accent);
    filter: drop-shadow(0 0 8px rgba(255, 209, 102, 0.4));
  }

  /* Layout */
  .game-container {
    gap: clamp(16px, 4vw, 28px);
    padding-left: max(16px, env(safe-area-inset-left));
    padding-right: max(16px, env(safe-area-inset-right));
  }

  h1 {
    background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 45%, var(--text-primary) 100%);
    text-shadow: 0 0 22px rgba(255, 209, 102, 0.35);
  }

  h1::after { content: 'üí∞'; right: -0.4em; }

  /* Stats cards */
  .game-stats { max-width: min(92vw, 720px); gap: clamp(10px, 3vw, 20px); }

  #walletDisplay,
  #freeSpinCounter {
    background: linear-gradient(180deg, var(--card-bg), transparent);
    border: 1px solid var(--border-subtle);
    box-shadow: var(--shadow-soft), inset 0 1px 0 rgba(255,255,255,0.12);
    color: var(--text-primary);
    border-radius: 16px;
    padding: clamp(12px, 3vw, 20px) clamp(14px, 4vw, 28px);
    min-width: unset;
  }

  #freeSpinCounter { color: var(--accent); }

  /* Bet selector redesign */
  #betSelector {
    background: linear-gradient(180deg, var(--card-bg), transparent);
    border: 1px solid var(--border-subtle);
    border-radius: 18px;
    box-shadow: var(--shadow-soft);
    padding: clamp(12px, 3vw, 20px);
    gap: clamp(8px, 2.5vw, 12px);
    grid-template-columns: repeat(auto-fit, minmax(64px, 1fr));
    max-width: min(92vw, 720px);
  }

  #betSelector button {
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    border: 1px solid var(--border-subtle);
    color: var(--text-primary);
    border-radius: 12px;
    min-height: 48px;
    font-size: clamp(0.95rem, 2.8vw, 1.05rem);
    text-shadow: none;
  }

  #betSelector button.selected {
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-strong) 100%);
    color: #1b1200;
    border-color: transparent;
    box-shadow: 0 10px 28px rgba(255, 209, 102, 0.45), inset 0 1px 0 rgba(255,255,255,0.35);
  }

  /* Machine */
  #slotContainer {
    width: min(92vw, 560px);
    padding: clamp(12px, 3.5vw, 28px);
    background: linear-gradient(180deg, var(--card-bg), transparent);
    border: 1px solid var(--border-subtle);
    box-shadow: var(--shadow-soft), inset 0 1px 0 rgba(255,255,255,0.08);
    border-radius: 18px;
  }

  #slotGrid { gap: clamp(6px, 1.8vw, 12px); }

  .slotCell {
    background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
    border: 1px solid var(--border-subtle);
    border-radius: 14px;
    font-size: clamp(1.8rem, 7.5vw, 2.6rem);
    backdrop-filter: blur(10px);
  }

  .slotCell:hover { border-color: rgba(255, 209, 102, 0.45); }

  /* Win effects */
  .winning {
    background: linear-gradient(135deg, rgba(255, 209, 102, 0.28), rgba(255, 209, 102, 0.36));
    border-color: var(--accent);
    box-shadow: 0 0 28px rgba(255, 209, 102, 0.55), 0 6px 22px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.25);
  }

  .winLine { stroke: var(--accent); }

  @keyframes wiggleGlow {
    0% {
      stroke: var(--accent);
      stroke-width: 4;
      filter: drop-shadow(0 0 6px var(--accent));
      transform: translate(0,0) rotate(0deg);
      opacity: 0.95;
    }
    50% {
      stroke-width: 5;
      filter: drop-shadow(0 0 12px rgba(255, 209, 102, 0.9));
      transform: translate(1px, -1px) rotate(1deg);
      opacity: 1;
    }
    100% {
      stroke: var(--accent);
      stroke-width: 4;
      filter: drop-shadow(0 0 6px var(--accent));
      transform: translate(0,0) rotate(0deg);
      opacity: 0.95;
    }
  }

  /* Primary action */
  #spinBtn {
    background: linear-gradient(135deg, var(--accent), var(--accent-strong), var(--accent));
    color: #1b1200;
    letter-spacing: 1px;
    border-radius: 16px;
    font-size: clamp(1.05rem, 4.8vw, 1.35rem);
    padding: clamp(14px, 4vw, 18px) clamp(22px, 8vw, 36px);
    min-width: min(82vw, 420px);
    position: sticky;
    bottom: calc(env(safe-area-inset-bottom) + 12px);
    align-self: center;
    z-index: 3;
  }

  #spinBtn:disabled { background: rgba(255, 255, 255, 0.18); color: rgba(0,0,0,0.45); }

  /* Messages */
  #message {
    background: linear-gradient(180deg, var(--card-bg), transparent);
    border: 1px solid var(--border-subtle);
    color: var(--text-secondary);
    border-radius: 14px;
    padding: clamp(12px, 3vw, 18px) clamp(14px, 4vw, 22px);
    max-width: min(92vw, 720px);
  }

  /* Pay table restyle */
  #payTableContainer {
    background: linear-gradient(180deg, var(--card-bg), rgba(255,255,255,0.02));
    color: var(--text-primary);
    border: 1px solid var(--border-subtle);
    border-radius: 16px;
    box-shadow: var(--shadow-soft);
    padding: clamp(12px, 4vw, 20px);
    max-width: min(92vw, 760px);
    margin: 0; /* prevent extra page height when used inside modal */
  }

  #payTableContainer::before {
    content: 'PAYOUTS';
    top: -12px;
    background: var(--bg-1);
    color: var(--accent-strong);
    border-radius: 10px;
    border: 1px solid var(--border-subtle);
  }

  #payTableContainer::after { display: none; }

  #payTableContainer table { min-width: 380px; color: var(--text-primary); font-family: inherit; }
  #payTableContainer th, #payTableContainer td { color: var(--text-secondary); border-bottom: 1px solid var(--border-subtle); }
  #payTableContainer th { color: var(--text-primary); border-bottom: 1px solid var(--accent-soft); }
  #payTableContainer tr:hover { background: rgba(255, 209, 102, 0.08); }

  /* Action buttons */
  #openPayTableBtn, #autoSpinBtn, #leaveGameBtn {
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    border: 1px solid var(--border-subtle);
    color: var(--text-primary);
    border-radius: 12px;
    padding: 10px 14px;
    font-weight: 700;
    font-size: clamp(0.9rem, 3.2vw, 1rem);
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  }

  #openPayTableBtn:hover, #autoSpinBtn:hover, #leaveGameBtn:hover {
    transform: translateY(-1px);
    border-color: rgba(255,255,255,0.28);
  }

  #autoSpinBtn[data-running="true"] {
    background: linear-gradient(135deg, var(--accent-soft), rgba(255,255,255,0.08));
    border-color: var(--accent-soft);
    color: var(--bg-1);
  }

  .actions-row {
    width: 100%;
    max-width: min(92vw, 720px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }

  .actions-row > button {
    flex: 1;
    min-width: 0;
  }

  /* Modal styles */
  #paytableModal {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  #paytableModal.open { display: flex; }

  #paytableModal .modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(4px);
  }

  #paytableModal .modal-dialog {
    position: relative;
    z-index: 1;
    width: min(94vw, 820px);
    max-height: min(86dvh, 860px);
    padding: clamp(10px, 2.5vw, 16px);
    background: linear-gradient(180deg, var(--bg-1), var(--bg-2));
    border: 1px solid var(--border-subtle);
    border-radius: 16px;
    box-shadow: 0 18px 60px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  #paytableModal .modal-body {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }

  #closePayTableBtn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: transparent;
    border: 1px solid var(--border-subtle);
    color: var(--text-primary);
    border-radius: 10px;
    width: 36px;
    height: 36px;
    cursor: pointer;
    font-size: 1rem;
  }

  body.modal-open { overflow: hidden; height: 100dvh; }

  /* Links */
  a {
    color: #1b1200;
    background: linear-gradient(135deg, var(--accent), var(--accent-strong));
    border: none;
    border-radius: 12px;
    box-shadow: 0 10px 26px rgba(255, 209, 102, 0.35);
    font-weight: 800;
  }
  a:hover { transform: translateY(-2px) scale(1.01); }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; }
  }

  /* Small devices fine-tuning */
  @media (max-width: 430px) {
    #slotContainer { width: 100%; }
    #spinBtn { min-width: 100%; }
    html, body { height: 100dvh; overflow: hidden; }
    #backLinkWrap { display: none; }
  }

  @media (max-width: 360px) {
    .game-stats { gap: 8px; }
    #betSelector { grid-template-columns: repeat(3, 1fr); }
  }

  /* =============================
     Foldable / Flip two-pane layout
     ============================= */
  .fold-top, .fold-bottom { box-sizing: border-box; }

  /* Default mobile portrait fallback: split screen vertically */
  @media (max-width: 480px) {
    .game-container {
      display: grid;
      grid-template-rows: 1fr 1fr;
      align-items: stretch;
      justify-items: center;
      gap: 0;
      padding: 0;
      min-height: 100dvh;
    }
    .fold-top {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 12px;
      overflow: hidden;
      width: 100%;
    }
    .fold-bottom {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 12px;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      position: relative; /* for sticky children */
      width: 100%;
      padding-bottom: calc(env(safe-area-inset-bottom) + 12px);
    }
    /* Hide big title to prioritize reels on small flip screens */
    h1 { display: none; }
  }

  /* Opened flip with a horizontal hinge (top/bottom segments) */
  @media (spanning: single-fold-horizontal) {
    .game-container {
      display: grid;
      grid-template-rows: env(viewport-segment-height 0 0) env(viewport-segment-height 0 1);
      height: calc(env(viewport-segment-height 0 0) + env(viewport-segment-height 0 1));
      gap: 0;
      padding: 0;
    }
    .fold-top {
      height: env(viewport-segment-height 0 0);
      padding-top: calc(env(safe-area-inset-top) + 8px);
      overflow: hidden;
    }
    .fold-bottom {
      height: env(viewport-segment-height 0 1);
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      position: relative;
      padding-bottom: calc(env(safe-area-inset-bottom) + 12px);
    }
    /* Prioritize reels on top segment */
    h1 { display: none; }
  }

  /* Alt detection for vertical segments (top/bottom) */
  @media (vertical-viewport-segments: 2) {
    .game-container {
      display: grid;
      grid-template-rows: 1fr 1fr;
      height: 100dvh;
      gap: 0;
      padding: 0;
    }
    .fold-bottom { overflow: auto; position: relative; }
  }
</style>
</head>
<body>
<div id="moneyParticles"></div>
<div class="game-container">
  <div class="fold-top">
    <h1>Markk'dBills Slot Machine</h1>
    <div id="slotContainer" aria-label="Slot Machine Container">
      <div id="slotGrid" aria-label="Slot Machine Grid" role="grid"></div>
      <svg id="linesSvg" aria-hidden="true"></svg>
    </div>
  </div>

  <div class="fold-bottom">
    <div id="betSelector" aria-label="Bet Selector">
      <button data-bet="10" class="selected">$10</button>
      <button data-bet="20">$20</button>
      <button data-bet="30">$30</button>
      <button data-bet="40">$40</button>
      <button data-bet="50">$50</button>
    </div>

    <button id="spinBtn" aria-label="Spin Button">üé∞ Spin</button>

    <div id="message"></div>

    <div class="game-stats">
      <div id="walletDisplay">Balance: $0</div>
      <div id="freeSpinCounter" style="display:none;">Free Spins Left: 0</div>
    </div>

    <div class="actions-row">
      <button id="autoSpinBtn" type="button" aria-pressed="false" title="Start Auto Spin">‚ñ∂Ô∏è Auto Spin</button>
      <button id="openPayTableBtn" type="button" aria-haspopup="dialog" aria-controls="paytableModal">üìú Pay Table</button>
      <button id="leaveGameBtn" type="button" title="Leave this game">üö™ Leave Game</button>
    </div>
  </div>

  <!-- Pay Table Modal -->
  <div id="paytableModal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="paytableTitle">
      <button id="closePayTableBtn" type="button" aria-label="Close">‚úï</button>
      <div class="modal-body">
        <div id="payTableContainer">
          <h3 id="paytableTitle" style="color: #000000; text-align: center; margin-bottom: 20px; font-family: 'Courier New', monospace; font-size: 1.2em; letter-spacing: 3px;">PAYOUT TABLE</h3>
          <table>
            <thead>
              <tr>
                <th>Symbol</th>
                <th>Bet</th>
                <th>3x</th>
                <th>4x</th>
                <th>5x</th>
              </tr>
            </thead>
            <tbody>
              <!-- üí¥ Japanese Yen -->
              <tr><td rowspan="5">üí¥ Yen</td><td>$10</td><td>$11</td><td>$22</td><td>$33</td></tr>
              <tr><td>$20</td><td>$22</td><td>$44</td><td>$66</td></tr>
              <tr><td>$30</td><td>$33</td><td>$66</td><td>$99</td></tr>
              <tr><td>$40</td><td>$44</td><td>$88</td><td>$132</td></tr>
              <tr><td>$50</td><td>$55</td><td>$110</td><td>$165</td></tr>

              <!-- üíµ US Dollar -->
              <tr><td rowspan="5">üíµ USD</td><td>$10</td><td>$22</td><td>$44</td><td>$66</td></tr>
              <tr><td>$20</td><td>$44</td><td>$88</td><td>$132</td></tr>
              <tr><td>$30</td><td>$66</td><td>$132</td><td>$198</td></tr>
              <tr><td>$40</td><td>$88</td><td>$176</td><td>$264</td></tr>
              <tr><td>$50</td><td>$110</td><td>$220</td><td>$330</td></tr>

              <!-- üí∂ Euro -->
              <tr><td rowspan="5">üí∂ Euro</td><td>$10</td><td>$33</td><td>$66</td><td>$99</td></tr>
              <tr><td>$20</td><td>$66</td><td>$132</td><td>$198</td></tr>
              <tr><td>$30</td><td>$99</td><td>$198</td><td>$297</td></tr>
              <tr><td>$40</td><td>$132</td><td>$264</td><td>$396</td></tr>
              <tr><td>$50</td><td>$165</td><td>$330</td><td>$495</td></tr>

              <!-- üí∑ Pound -->
              <tr><td rowspan="5">üí∑ Pound</td><td>$10</td><td>$44</td><td>$88</td><td>$132</td></tr>
              <tr><td>$20</td><td>$88</td><td>$176</td><td>$264</td></tr>
              <tr><td>$30</td><td>$132</td><td>$264</td><td>$396</td></tr>
              <tr><td>$40</td><td>$176</td><td>$352</td><td>$528</td></tr>
              <tr><td>$50</td><td>$220</td><td>$440</td><td>$660</td></tr>

              <!-- üí≥ Credit Card -->
              <tr><td rowspan="5">üí≥ Card</td><td>$10</td><td>$110</td><td>$220</td><td>$330</td></tr>
              <tr><td>$20</td><td>$220</td><td>$440</td><td>$660</td></tr>
              <tr><td>$30</td><td>$330</td><td>$660</td><td>$990</td></tr>
              <tr><td>$40</td><td>$440</td><td>$880</td><td>$1320</td></tr>
              <tr><td>$50</td><td>$550</td><td>$1100</td><td>$1650</td></tr>

              <!-- üí≤ Wild Bonus -->
              <tr><td colspan="5">üí≤ Wild Bonus: 3x = 5 Free Spins | 5x = 10 Free Spins</td></tr>
              <tr><td colspan="5">üèß ATM: Wild (replaces any except üí≥ & üí≤)</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div id="backLinkWrap" style="text-align: center; margin-top: 40px;">
    <a href="../index.html" style="color: #00ff88; user-select: none; text-decoration: none; background: rgba(0, 255, 136, 0.1); border: 2px solid #00ff88; border-radius: 12px; padding: 12px 24px; backdrop-filter: blur(10px); transition: all 0.3s ease; font-weight: 600;">üè† Back to Arcade</a>
  </div>
</div>


<script>
(() => {
  'use strict';

  const rows = 3;
  const cols = 5;

  const symbols = [
    { sym: "üí¥", name: "Yen" },
    { sym: "üíµ", name: "USD" },
    { sym: "üí∂", name: "Euro" },
    { sym: "üí∑", name: "Pound" },
    { sym: "üí≥", name: "Credit Card" },
    { sym: "üí±", name: "Currency Exchange" },
    { sym: "üí≤", name: "Wild" },
    { sym: "üèß", name: "ATM" }
  ];

  const weights = {
    "üí¥": 20,
    "üíµ": 20,
    "üí∂": 15,
    "üí∑": 10,
    "üí≥": 5,
    "üí±": 15,
    "üí≤": 10,
    "üèß": 5
  };

  const payouts = {
    "üí¥": { 10: [11, 22, 33], 20: [22, 44, 66], 30: [33, 66, 99], 40: [44, 88, 132], 50: [55, 110, 165] },
    "üíµ": { 10: [22, 44, 66], 20: [44, 88, 132], 30: [66, 132, 198], 40: [88, 176, 264], 50: [110, 220, 330] },
    "üí∂": { 10: [33, 66, 99], 20: [66, 132, 198], 30: [99, 198, 297], 40: [132, 264, 396], 50: [165, 330, 495] },
    "üí∑": { 10: [44, 88, 132], 20: [88, 176, 264], 30: [132, 264, 396], 40: [176, 352, 528], 50: [220, 440, 660] },
    "üí≥": { 10: [110, 220, 330], 20: [220, 440, 660], 30: [330, 660, 990], 40: [440, 880, 1320], 50: [550, 1100, 1650] },
    "üí±": { 10: [-11, -22, -33], 20: [-22, -44, -66], 30: [-33, -66, -99], 40: [-44, -88, -132], 50: [-55, -110, -165] }
  };

  const freeSpinsAward = { 3: 5, 5: 10 };

  // Simple, clean lottery machine sounds
  function createLotterySound(frequency, duration, type = 'beep') {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
      oscillator.type = 'sine';
      
      // Clean, short sounds
      gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration);
    } catch (e) {
      // Silent fail
    }
  }

  // Clean lottery machine sound system
  function playSound(soundName, volume = 0.7) {
    try {
      if (soundName === 'spin') {
        // Quick mechanical click
        createLotterySound(400, 30);
      } else if (soundName === 'stop') {
        // Sharp stop sound
        createLotterySound(600, 40);
      } else if (soundName === 'win') {
        // Pleasant win chime
        createLotterySound(800, 80);
      } else if (soundName === 'bigWin') {
        // Double chime for big wins
        createLotterySound(1000, 100);
        setTimeout(() => createLotterySound(1200, 80), 50);
      } else if (soundName === 'lose') {
        // Soft lose sound
        createLotterySound(200, 60);
      } else if (soundName === 'button') {
        // Button click
        createLotterySound(500, 25);
      } else if (soundName === 'hover') {
        // Subtle hover
        createLotterySound(300, 20);
      } else if (soundName === 'coin') {
        // Coin drop
        createLotterySound(700, 60);
      } else {
        // Default
        createLotterySound(400, 40);
      }
    } catch (e) {
      // Silent fail
    }
  }

  // Add sound effects to all buttons
  document.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', () => {
      playSound('button', 0.8);
      // Add button press animation
      btn.style.transform = 'scale(0.95)';
      setTimeout(() => {
        btn.style.transform = '';
      }, 100);
    });
    
    btn.addEventListener('mouseenter', () => {
      playSound('hover', 0.5);
    });
  });

  const walletDisplay = document.getElementById('walletDisplay');
  const betSelector = document.getElementById('betSelector');
  const spinBtn = document.getElementById('spinBtn');
  const autoSpinBtn = document.getElementById('autoSpinBtn');
  const slotGrid = document.getElementById('slotGrid');
  const linesSvg = document.getElementById('linesSvg');
  const messageEl = document.getElementById('message');
  const freeSpinCounterEl = document.getElementById('freeSpinCounter');
  const openPayTableBtn = document.getElementById('openPayTableBtn');
  const paytableModal = document.getElementById('paytableModal');
  const closePayTableBtn = document.getElementById('closePayTableBtn');
  const leaveGameBtn = document.getElementById('leaveGameBtn');

  let balance = Number(localStorage.getItem('localPlayerCash')) || 0;
  let freeSpins = Number(localStorage.getItem('freeSpins')) || 0;
  let bet = 10;
  let spinning = false;
  let autoSpinning = false;

  // Removed old audio files - now using Web Audio API for lottery machine sounds

  const cells = [];
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const cell = document.createElement('div');
      cell.classList.add('slotCell');
      cell.setAttribute('role', 'gridcell');
      cell.setAttribute('aria-rowindex', r + 1);
      cell.setAttribute('aria-colindex', c + 1);
      slotGrid.appendChild(cell);
      cells.push(cell);
    }
  }

  // Money particle system for win effects
  function createParticles(winIndices) {
    winIndices.forEach(index => {
      const cell = cells[index];
      const rect = cell.getBoundingClientRect();
      
      for (let i = 0; i < 12; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'fixed';
        particle.style.left = rect.left + rect.width / 2 + 'px';
        particle.style.top = rect.top + rect.height / 2 + 'px';
        particle.style.fontSize = '1.5rem';
        particle.style.pointerEvents = 'none';
        particle.style.zIndex = '1000';
        particle.style.color = '#00ff88';
        particle.style.filter = 'drop-shadow(0 0 8px rgba(0, 255, 136, 0.6))';
        particle.textContent = ['üí∞', 'üíµ', 'üí¥', 'üí∂', 'üí∑'][Math.floor(Math.random() * 5)];
        
        document.body.appendChild(particle);
        
        const angle = (i / 12) * Math.PI * 2;
        const velocity = 120 + Math.random() * 80;
        const lifetime = 1500 + Math.random() * 500;
        
        particle.animate([
          { 
            transform: 'translate(0, 0) scale(1) rotate(0deg)',
            opacity: 1
          },
          { 
            transform: `translate(${Math.cos(angle) * velocity}px, ${Math.sin(angle) * velocity}px) scale(0) rotate(360deg)`,
            opacity: 0
          }
        ], {
          duration: lifetime,
          easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
        }).onfinish = () => {
          document.body.removeChild(particle);
        };
      }
    });
  }

  // Create floating money particles
  function createMoneyParticle() {
    const particle = document.createElement('div');
    particle.classList.add('money-particle');
    const moneySymbols = ['üí∞', 'üíµ', 'üí¥', 'üí∂', 'üí∑', 'üí≥', 'üí≤'];
    particle.textContent = moneySymbols[Math.floor(Math.random(  // Leave game: simple navigation back to arcade with balance persisted
  leaveGameBtn?.addEventListener('click', () => {
    try { localStorage.setItem('localPlayerCash', balance.toFixed(2)); } catch {}
    window.location.href = '../emoji-slots.html';
  });* 8) + 's';
    document.getElementById('moneyParticles').appendChild(particle);
    
    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }, 10000);
  }

  // Start money particle animation
  setInterval(createMoneyParticle, 800);

  // Pay Table modal controls
  function openPaytable() {
    if (!paytableModal) return;
    paytableModal.classList.add('open');
    paytableModal.setAttribute('aria-hidden', 'false');
    document.body.classList.add('modal-open');
  }

  function closePaytable() {
    if (!paytableModal) return;
    paytableModal.classList.remove('open');
    paytableModal.setAttribute('aria-hidden', 'true');
    document.body.classList.remove('modal-open');
  }

  openPayTableBtn?.addEventListener('click', openPaytable);
  closePayTableBtn?.addEventListener('click', closePaytable);
  paytableModal?.addEventListener('click', (e) => {
    const target = e.target;
    if (target && target instanceof Element && (target.classList.contains('modal-backdrop') || target.getAttribute('data-close') === 'true')) {
      closePaytable();
    }
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closePaytable();
  });

  // Leave game: simple navigation back to arcade with balance persisted
  leaveGameBtn?.addEventListener('click', () => {
    try { localStorage.setItem('localPlayerCash', balance.toFixed(2)); } catch {}
    window.location.href = '../emoji-slots.html';
  });

  function setAutoSpinRunning(running) {
    autoSpinning = running;
    if (!autoSpinBtn) return;
    autoSpinBtn.dataset.running = running ? 'true' : 'false';
    autoSpinBtn.setAttribute('aria-pressed', running ? 'true' : 'false');
    autoSpinBtn.textContent = running ? '‚èπ Stop Auto' : '‚ñ∂Ô∏è Auto Spin';
  }

  async function runAutoSpinLoop() {
    if (spinning || !autoSpinning) return;
    while (autoSpinning) {
      // If out of funds and no free spins, stop
      const selectedBetBtn = betSelector.querySelector('button.selected');
      const currentBet = Number(selectedBetBtn.dataset.bet);
      if (balance < currentBet && freeSpins === 0) {
        setAutoSpinRunning(false);
        break;
      }
      // Perform a spin
      await spin();
      // If free spins were won during that spin, stop auto
      if (freeSpins > 0) {
        showMessage('Auto stopped: Free spins awarded!');
        setAutoSpinRunning(false);
        break;
      }
      // Small delay between spins to avoid tight loop
      await new Promise(r => setTimeout(r, 300));
    }
  }

  autoSpinBtn?.addEventListener('click', async () => {
    if (!autoSpinning) {
      setAutoSpinRunning(true);
      runAutoSpinLoop();
    } else {
      setAutoSpinRunning(false);
    }
  });

  function weightedRandomSymbol() {
    const totalWeight = Object.values(weights).reduce((a,b) => a+b, 0);
    let rnd = Math.random() * totalWeight;
    for (const sym of symbols) {
      rnd -= weights[sym.sym];
      if (rnd < 0) return sym.sym;
    }
    return symbols[0].sym;
  }

  function fillGridRandom() {
    const arr = [];
    for(let i=0; i<rows*cols; i++) {
      arr.push(weightedRandomSymbol());
    }
    return arr;
  }

  function renderGrid(arr) {
    for(let i=0; i < arr.length; i++) {
      cells[i].textContent = arr[i];
      cells[i].classList.remove('winning');
    }
  }

  function clearLines() {
    while(linesSvg.firstChild) linesSvg.removeChild(linesSvg.firstChild);
  }

  function drawWinLines(lines) {
    clearLines();
    const svgNS = "http://www.w3.org/2000/svg";
    lines.forEach(lineCells => {
      if(lineCells.length < 2) return;
      for(let i=0; i < lineCells.length - 1; i++) {
        const fromCell = cells[lineCells[i]];
        const toCell = cells[lineCells[i+1]];
        const fromRect = fromCell.getBoundingClientRect();
        const toRect = toCell.getBoundingClientRect();
        const svgRect = linesSvg.getBoundingClientRect();
        const x1 = fromRect.left + fromRect.width/2 - svgRect.left;
        const y1 = fromRect.top + fromRect.height/2 - svgRect.top;
        const x2 = toRect.left + toRect.width/2 - svgRect.left;
        const y2 = toRect.top + toRect.height/2 - svgRect.top;
        const line = document.createElementNS(svgNS, 'line');
        line.setAttribute('x1', x1);
        line.setAttribute('y1', y1);
        line.setAttribute('x2', x2);
        line.setAttribute('y2', y2);
        line.classList.add('winLine');
        linesSvg.appendChild(line);
      }
    });
  }

  function highlightWinningCells(winIndices) {
    winIndices.forEach(i => cells[i].classList.add('winning'));
  }

  function findMatches(gridArr) {
    const matches = [];
    for(let r=0; r<rows; r++) {
      let streak = [r*cols];
      for(let c=1; c<cols; c++) {
        const currIdx = r*cols + c;
        const prevIdx = r*cols + c - 1;
        if (gridArr[currIdx] === gridArr[prevIdx] && isSymbolMatchable(gridArr[currIdx])) {
          streak.push(currIdx);
        } else {
          if(streak.length >= 3) matches.push([...streak]);
          streak = [currIdx];
        }
      }
      if(streak.length >= 3) matches.push([...streak]);
    }

    for(let c=0; c<cols; c++) {
      let streak = [c];
      for(let r=1; r<rows; r++) {
        const currIdx = r*cols + c;
        const prevIdx = (r-1)*cols + c;
        if(gridArr[currIdx] === gridArr[prevIdx] && isSymbolMatchable(gridArr[currIdx])) {
          streak.push(currIdx);
        } else {
          if(streak.length >= 3) matches.push([...streak]);
          streak = [currIdx];
        }
      }
      if(streak.length >= 3) matches.push([...streak]);
    }

    return matches;
  }

  function isSymbolMatchable(sym) {
    return ["üí¥", "üíµ", "üí∂", "üí∑", "üí≥", "üí±"].includes(sym);
  }

  function calculatePayout(matches, gridArr, bet) {
    let totalPayout = 0;
    let wildCount = 0;

    matches.forEach(group => {
      const sym = gridArr[group[0]];
      if (sym === "üí≤") return;
      const count = group.length;
      if(payouts[sym] && payouts[sym][bet]) {
        const payoutArray = payouts[sym][bet];
        if(count >= 3 && count <= 5) {
          const payoutVal = payoutArray[count - 3];
          totalPayout += payoutVal;
        }
      }
    });

    wildCount = gridArr.filter(s => s === "üí≤").length;
    if(freeSpinsAward[wildCount]) {
      freeSpins += freeSpinsAward[wildCount];
      updateFreeSpinsDisplay();
      showMessage(`Congrats! You got ${freeSpinsAward[wildCount]} free spins!`);
    }

    return totalPayout;
  }

  function showMessage(msg) {
    messageEl.textContent = msg;
  }

  function updateBalanceDisplay() {
    walletDisplay.textContent = `Balance: $${balance.toFixed(2)}`;
    localStorage.setItem('localPlayerCash', balance.toFixed(2));
  }

  function updateFreeSpinsDisplay() {
    if(freeSpins > 0) {
      freeSpinCounterEl.style.display = 'block';
      freeSpinCounterEl.textContent = `Free Spins Left: ${freeSpins}`;
    } else {
      freeSpinCounterEl.style.display = 'none';
    }
    localStorage.setItem('freeSpins', freeSpins);
  }

  async function spin() {
    if (spinning) return;
    spinning = true;
    clearLines();
    messageEl.textContent = '';

    const selectedBetBtn = betSelector.querySelector('button.selected');
    bet = Number(selectedBetBtn.dataset.bet);

    if (bet > balance && freeSpins === 0) {
      showMessage('Insufficient balance for this bet!');
      spinning = false;
      return;
    }

    spinBtn.disabled = true;

    if (freeSpins > 0) {
      freeSpins--;
      updateFreeSpinsDisplay();
      showMessage('Free spin!');
    } else {
      balance -= bet;
      updateBalanceDisplay();
      showMessage(`Bet: $${bet}`);
    }

    playSound('spin', 0.8);

    // Prepare final grid for spin results
    const finalGrid = fillGridRandom();

    // Animate each column spinning with staggered start and staggered stop
    const spinDuration = 3000; // total spin time per column
    const spinStartDelay = 300; // delay between starting each column spin

    // Function to spin a single column for given duration
    async function spinColumn(colIndex, duration) {
      const columnCells = [];
      for (let r = 0; r < rows; r++) {
        columnCells.push(cells[r * cols + colIndex]);
      }
      const startTime = performance.now();

      return new Promise(resolve => {
        function animate() {
          const now = performance.now();
          if (now - startTime >= duration) {
            // Set final symbols for column
            for (let r = 0; r < rows; r++) {
              columnCells[r].textContent = finalGrid[r * cols + colIndex];
              columnCells[r].classList.remove('spinning');
            }
            resolve();
            return;
          }
          // Show random symbols during spinning with enhanced animation
          for (let r = 0; r < rows; r++) {
            columnCells[r].textContent = weightedRandomSymbol();
            columnCells[r].classList.add('spinning');
          }
          requestAnimationFrame(animate);
        }
        animate();
      });
    }

    const spinPromises = [];

    // Start spinning each column one by one
    for (let col = 0; col < cols; col++) {
      await new Promise(r => setTimeout(r, spinStartDelay));
      spinPromises.push(spinColumn(col, spinDuration));
    }

    // Wait 1 second while all columns spin together
    await new Promise(r => setTimeout(r, 1000));

    // Stop columns one by one from left to right (await each spin)
    for (let i = 0; i < spinPromises.length; i++) {
      await spinPromises[i];
      playSound('stop', 0.6);
    }

    // Show final grid
    renderGrid(finalGrid);
    const matches = findMatches(finalGrid);

    if (matches.length === 0) {
      showMessage('No matches. Better luck next time!');
      playSound('lose', 0.6);
    } else {
      const winIndices = matches.flat();
      highlightWinningCells(winIndices);
      drawWinLines(matches);
      createParticles(winIndices); // Add particle effects for wins
      const payout = calculatePayout(matches, finalGrid, bet);
      if (payout > 0) {
        balance += payout;
        updateBalanceDisplay();
        showMessage(`üéâ You won $${payout.toFixed(2)}! üéâ`);
        
        // Enhanced sound effects based on win size
        if (payout > bet * 10) {
          playSound('bigWin', 1.0);
        } else if (payout > bet * 5) {
          playSound('win', 0.9);
        } else {
          playSound('win', 0.7);
        }
        
        // Add screen flash effect for big wins
        if (payout > bet * 5) {
          document.body.style.animation = 'bigWinFlash 0.5s ease-in-out';
          setTimeout(() => {
            document.body.style.animation = '';
          }, 500);
        }
        
        // Coin sound for balance update
        setTimeout(() => {
          playSound('coin', 0.5);
        }, 300);
      } else {
        showMessage('Matches with no payout.');
      }
    }

    spinning = false;
    spinBtn.disabled = false;
  }

  betSelector.addEventListener('click', e => {
    if (e.target.tagName !== 'BUTTON') return;
    betSelector.querySelectorAll('button').forEach(b => {
      b.classList.remove('selected');
      b.setAttribute('aria-pressed', 'false');
    });
    e.target.classList.add('selected');
    e.target.setAttribute('aria-pressed', 'true');
  });

  spinBtn.addEventListener('click', spin);

  updateBalanceDisplay();
  updateFreeSpinsDisplay();
  renderGrid(fillGridRandom());

})();
</script>


</body>
</html> 