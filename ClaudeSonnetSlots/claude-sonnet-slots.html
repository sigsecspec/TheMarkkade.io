<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude 4 Sonnet Slots - AI Casino Experience</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* Motorola Razr 2024 Dual Screen Layout */
        .game-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Top Screen - Display Area */
        .top-screen {
            height: 50vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-bottom: 3px solid #ffd700;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        /* Animated Background Particles */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 215, 0, 0.6);
            border-radius: 50%;
            animation: float 6s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-10px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Claude Branding */
        .claude-logo {
            position: absolute;
            top: 10px;
            left: 20px;
            z-index: 10;
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .ai-neural-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(255, 215, 0, 0.2) 0%, transparent 50%);
        }

        /* Slot Machine Display */
        .slot-machine {
            position: relative;
            z-index: 5;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-title {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(255, 215, 0, 0.5); }
            to { text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        .reels-container {
            display: flex;
            gap: 10px;
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #ffd700;
            box-shadow: 
                inset 0 0 20px rgba(0,0,0,0.5),
                0 0 30px rgba(255, 215, 0, 0.3);
            margin-bottom: 15px;
        }

        .reel {
            width: 80px;
            height: 120px;
            background: linear-gradient(145deg, #333, #111);
            border: 2px solid #666;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        }

        .reel-symbols {
            position: absolute;
            width: 100%;
            transition: transform 0.1s ease-out;
        }

        .symbol {
            width: 100%;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
        }

        /* Game Stats Display */
        .stats-display {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 300px;
            font-size: 14px;
            font-weight: bold;
        }

        .stat-item {
            background: rgba(0,0,0,0.6);
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ffd700;
        }

        /* Bottom Screen - Controls */
        .bottom-screen {
            height: 50vh;
            background: linear-gradient(135deg, #0f0f0f 0%, #2d2d2d 100%);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            position: relative;
        }

        /* Control Panels */
        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .bet-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-btn {
            background: linear-gradient(145deg, #4a4a4a, #2a2a2a);
            border: 2px solid #ffd700;
            color: #ffd700;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            min-width: 60px;
            text-align: center;
        }

        .control-btn:hover {
            background: linear-gradient(145deg, #5a5a5a, #3a3a3a);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            transform: translateY(-2px);
        }

        .control-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .control-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Spin Button */
        .spin-btn {
            background: linear-gradient(145deg, #ff6b6b, #d63031);
            border: 3px solid #ffd700;
            color: #fff;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            margin: 0 auto;
            display: block;
            min-width: 150px;
        }

        .spin-btn:hover {
            background: linear-gradient(145deg, #ff7675, #e17055);
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
            transform: translateY(-3px);
        }

        .spin-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }

        .spin-btn.spinning {
            background: linear-gradient(145deg, #fdcb6e, #e17055);
            animation: spin-pulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes spin-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        /* Balance and Bet Display */
        .balance-display {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ffd700;
            text-align: center;
            margin-bottom: 15px;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 0 0 10px rgba(0,255,0,0.5);
        }

        .bet-amount {
            font-size: 18px;
            color: #ffd700;
            margin-top: 5px;
        }

        /* Win Effects */
        .win-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 15;
        }

        .win-overlay.active {
            opacity: 1;
            animation: win-flash 1s ease-in-out;
        }

        @keyframes win-flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .win-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            opacity: 0;
            z-index: 20;
            pointer-events: none;
        }

        .win-message.show {
            opacity: 1;
            animation: win-bounce 2s ease-out;
        }

        @keyframes win-bounce {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Claude Attribution */
        .claude-attribution {
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 10px;
            color: rgba(255, 215, 0, 0.7);
            font-style: italic;
        }

        /* Payline Indicators */
        .paylines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 8;
        }

        .payline {
            position: absolute;
            height: 2px;
            background: rgba(255, 215, 0, 0.8);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .payline.active {
            opacity: 1;
            animation: payline-glow 1s ease-in-out infinite alternate;
        }

        @keyframes payline-glow {
            from { box-shadow: 0 0 5px rgba(255, 215, 0, 0.8); }
            to { box-shadow: 0 0 15px rgba(255, 215, 0, 1); }
        }

        /* Responsive adjustments for smaller screens */
        @media (max-height: 600px) {
            .game-title { font-size: 20px; }
            .reels-container { padding: 15px; }
            .reel { width: 70px; height: 100px; }
            .symbol { height: 33px; font-size: 24px; }
            .control-btn { padding: 10px 15px; font-size: 12px; }
            .spin-btn { padding: 15px 30px; font-size: 18px; }
        }

        /* Touch feedback */
        .touch-feedback {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, transparent 70%);
            pointer-events: none;
            z-index: 25;
            animation: touch-ripple 0.6s ease-out;
        }

        @keyframes touch-ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Top Screen - Display Area -->
        <div class="top-screen" id="topScreen">
            <div class="particles" id="particles"></div>
            <div class="ai-neural-bg"></div>
            <div class="claude-logo">Claude 4 Sonnet</div>
            
            <div class="slot-machine">
                <div class="game-title">AI NEURAL SLOTS</div>
                
                <div class="reels-container">
                    <div class="paylines" id="paylines">
                        <div class="payline" style="top: 50%; left: 0; width: 100%;"></div>
                        <div class="payline" style="top: 33%; left: 0; width: 100%;"></div>
                        <div class="payline" style="top: 67%; left: 0; width: 100%;"></div>
                    </div>
                    
                    <div class="reel" id="reel1">
                        <div class="reel-symbols" id="symbols1"></div>
                    </div>
                    <div class="reel" id="reel2">
                        <div class="reel-symbols" id="symbols2"></div>
                    </div>
                    <div class="reel" id="reel3">
                        <div class="reel-symbols" id="symbols3"></div>
                    </div>
                </div>
                
                <div class="stats-display">
                    <div class="stat-item">Lines: <span id="activeLines">3</span></div>
                    <div class="stat-item">Win: <span id="lastWin">0</span></div>
                    <div class="stat-item">Mult: <span id="multiplier">1x</span></div>
                </div>
            </div>
            
            <div class="win-overlay" id="winOverlay"></div>
            <div class="win-message" id="winMessage"></div>
        </div>

        <!-- Bottom Screen - Controls -->
        <div class="bottom-screen">
            <div class="balance-display">
                <div class="balance-amount">$<span id="balance">1000</span></div>
                <div class="bet-amount">Bet: $<span id="currentBet">10</span></div>
            </div>

            <div class="control-row">
                <div class="bet-controls">
                    <button class="control-btn" id="betDown">BET -</button>
                    <button class="control-btn" id="betUp">BET +</button>
                </div>
                <div class="bet-controls">
                    <button class="control-btn" id="maxBet">MAX BET</button>
                    <button class="control-btn" id="autoSpin">AUTO</button>
                </div>
            </div>

            <button class="spin-btn" id="spinBtn">SPIN</button>

            <div class="control-row">
                <div class="bet-controls">
                    <button class="control-btn" id="linesDown">LINES -</button>
                    <button class="control-btn" id="linesUp">LINES +</button>
                </div>
                <div class="bet-controls">
                    <button class="control-btn" id="paytable">PAYTABLE</button>
                    <button class="control-btn" id="settings">SETTINGS</button>
                </div>
            </div>

            <div class="claude-attribution">Created by Claude 4 Sonnet</div>
        </div>
    </div>

    <script>
        class ClaudeSonnetSlots {
            constructor() {
                // Game state
                this.balance = 1000;
                this.currentBet = 10;
                this.activeLines = 3;
                this.isSpinning = false;
                this.autoSpinActive = false;
                this.multiplier = 1;
                
                // Claude-themed symbols with AI/Neural Network theme
                this.symbols = [
                    { symbol: '🧠', value: 100, color: '#ff6b6b', name: 'Neural Core' },
                    { symbol: '⚡', value: 80, color: '#ffd700', name: 'Energy Pulse' },
                    { symbol: '🔮', value: 60, color: '#74b9ff', name: 'AI Vision' },
                    { symbol: '💎', value: 50, color: '#00cec9', name: 'Data Crystal' },
                    { symbol: '🎯', value: 40, color: '#fd79a8', name: 'Target Lock' },
                    { symbol: '🌟', value: 30, color: '#fdcb6e', name: 'Insight Star' },
                    { symbol: '🔥', value: 25, color: '#e17055', name: 'Processing Fire' },
                    { symbol: '💫', value: 20, color: '#a29bfe', name: 'Quantum Spark' },
                    { symbol: '⭐', value: 15, color: '#ffeaa7', name: 'Logic Star' }
                ];
                
                this.reelPositions = [0, 0, 0];
                this.reelSymbols = [[], [], []];
                
                this.initializeGame();
                this.setupEventListeners();
                this.createParticles();
                this.generateReelSymbols();
                this.updateDisplay();
            }

            initializeGame() {
                // Initialize audio context for sound effects
                this.audioContext = null;
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio context not supported');
                }
                
                // Vibration support check
                this.hasVibration = 'vibrate' in navigator;
                
                console.log('Claude 4 Sonnet Slots initialized');
                console.log('Vibration support:', this.hasVibration);
            }

            setupEventListeners() {
                // Spin button
                document.getElementById('spinBtn').addEventListener('click', () => this.spin());
                
                // Bet controls
                document.getElementById('betDown').addEventListener('click', () => this.adjustBet(-5));
                document.getElementById('betUp').addEventListener('click', () => this.adjustBet(5));
                document.getElementById('maxBet').addEventListener('click', () => this.setMaxBet());
                
                // Line controls
                document.getElementById('linesDown').addEventListener('click', () => this.adjustLines(-1));
                document.getElementById('linesUp').addEventListener('click', () => this.adjustLines(1));
                
                // Auto spin
                document.getElementById('autoSpin').addEventListener('click', () => this.toggleAutoSpin());
                
                // Top screen touch effects
                document.getElementById('topScreen').addEventListener('click', (e) => this.createTouchEffect(e));
                
                // Add haptic feedback to all buttons
                document.querySelectorAll('.control-btn, .spin-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.vibrate(50));
                });
            }

            vibrate(duration) {
                if (this.hasVibration) {
                    navigator.vibrate(duration);
                }
            }

            createTouchEffect(e) {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const effect = document.createElement('div');
                effect.className = 'touch-feedback';
                effect.style.left = (x - 25) + 'px';
                effect.style.top = (y - 25) + 'px';
                
                e.currentTarget.appendChild(effect);
                
                // Add sparkle effect
                this.createSparkles(x, y, e.currentTarget);
                
                // Vibrate for touch feedback
                this.vibrate(30);
                
                setTimeout(() => effect.remove(), 600);
            }

            createSparkles(x, y, container) {
                for (let i = 0; i < 8; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.style.position = 'absolute';
                    sparkle.style.width = '4px';
                    sparkle.style.height = '4px';
                    sparkle.style.background = '#ffd700';
                    sparkle.style.borderRadius = '50%';
                    sparkle.style.left = x + 'px';
                    sparkle.style.top = y + 'px';
                    sparkle.style.pointerEvents = 'none';
                    sparkle.style.zIndex = '30';
                    
                    const angle = (i / 8) * Math.PI * 2;
                    const distance = 30 + Math.random() * 20;
                    const endX = x + Math.cos(angle) * distance;
                    const endY = y + Math.sin(angle) * distance;
                    
                    container.appendChild(sparkle);
                    
                    sparkle.animate([
                        { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                        { transform: `translate(${endX - x}px, ${endY - y}px) scale(0)`, opacity: 0 }
                    ], {
                        duration: 800,
                        easing: 'ease-out'
                    }).onfinish = () => sparkle.remove();
                }
            }

            createParticles() {
                const particlesContainer = document.getElementById('particles');
                
                setInterval(() => {
                    if (particlesContainer.children.length < 20) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 2 + 's';
                        particle.style.animationDuration = (4 + Math.random() * 4) + 's';
                        
                        particlesContainer.appendChild(particle);
                        
                        setTimeout(() => {
                            if (particle.parentNode) {
                                particle.remove();
                            }
                        }, 8000);
                    }
                }, 500);
            }

            generateReelSymbols() {
                for (let reel = 0; reel < 3; reel++) {
                    const symbolsContainer = document.getElementById(`symbols${reel + 1}`);
                    symbolsContainer.innerHTML = '';
                    
                    // Generate extended reel with symbols
                    const reelSymbols = [];
                    for (let i = 0; i < 20; i++) {
                        const randomSymbol = this.symbols[Math.floor(Math.random() * this.symbols.length)];
                        reelSymbols.push(randomSymbol);
                    }
                    
                    this.reelSymbols[reel] = reelSymbols;
                    
                    // Create visual symbols
                    reelSymbols.forEach((symbolData, index) => {
                        const symbolDiv = document.createElement('div');
                        symbolDiv.className = 'symbol';
                        symbolDiv.textContent = symbolData.symbol;
                        symbolDiv.style.color = symbolData.color;
                        symbolsContainer.appendChild(symbolDiv);
                    });
                }
            }

            adjustBet(amount) {
                const newBet = this.currentBet + amount;
                if (newBet >= 5 && newBet <= this.balance && newBet <= 100) {
                    this.currentBet = newBet;
                    this.updateDisplay();
                    this.playSound('beep');
                }
            }

            setMaxBet() {
                this.currentBet = Math.min(100, this.balance);
                this.updateDisplay();
                this.playSound('beep');
            }

            adjustLines(amount) {
                const newLines = this.activeLines + amount;
                if (newLines >= 1 && newLines <= 3) {
                    this.activeLines = newLines;
                    this.updateDisplay();
                    this.playSound('beep');
                }
            }

            toggleAutoSpin() {
                this.autoSpinActive = !this.autoSpinActive;
                const btn = document.getElementById('autoSpin');
                btn.textContent = this.autoSpinActive ? 'STOP' : 'AUTO';
                btn.style.background = this.autoSpinActive ? 
                    'linear-gradient(145deg, #00b894, #00a085)' : 
                    'linear-gradient(145deg, #4a4a4a, #2a2a2a)';
                
                if (this.autoSpinActive) {
                    this.autoSpinInterval = setInterval(() => {
                        if (!this.isSpinning && this.balance >= this.currentBet * this.activeLines) {
                            this.spin();
                        } else if (this.balance < this.currentBet * this.activeLines) {
                            this.toggleAutoSpin(); // Stop auto spin if insufficient funds
                        }
                    }, 3000);
                } else {
                    clearInterval(this.autoSpinInterval);
                }
            }

            async spin() {
                if (this.isSpinning || this.balance < this.currentBet * this.activeLines) {
                    return;
                }

                this.isSpinning = true;
                const totalBet = this.currentBet * this.activeLines;
                this.balance -= totalBet;
                
                // Update UI
                const spinBtn = document.getElementById('spinBtn');
                spinBtn.classList.add('spinning');
                spinBtn.textContent = 'SPINNING...';
                
                // Disable controls
                this.setControlsEnabled(false);
                
                // Vibrate for spin start
                this.vibrate([100, 50, 100]);
                
                // Play spin sound
                this.playSound('spin');
                
                // Animate reels
                await this.animateReels();
                
                // Check for wins
                const winResult = this.checkWins();
                
                if (winResult.totalWin > 0) {
                    this.balance += winResult.totalWin;
                    await this.showWinEffects(winResult);
                    this.vibrate([200, 100, 200, 100, 200]);
                } else {
                    // Loss vibration
                    this.vibrate(150);
                }
                
                // Update display
                this.updateDisplay();
                
                // Re-enable controls
                this.setControlsEnabled(true);
                spinBtn.classList.remove('spinning');
                spinBtn.textContent = 'SPIN';
                this.isSpinning = false;
            }

            async animateReels() {
                const spinDuration = 2000;
                const reelDelays = [0, 200, 400];
                
                const promises = [];
                
                for (let reel = 0; reel < 3; reel++) {
                    promises.push(new Promise(resolve => {
                        setTimeout(() => {
                            this.spinReel(reel, spinDuration - reelDelays[reel], resolve);
                        }, reelDelays[reel]);
                    }));
                }
                
                await Promise.all(promises);
            }

            spinReel(reelIndex, duration, callback) {
                const symbolsContainer = document.getElementById(`symbols${reelIndex + 1}`);
                const startTime = Date.now();
                const startPosition = this.reelPositions[reelIndex];
                const spins = 5 + Math.random() * 3; // 5-8 full spins
                const finalPosition = Math.floor(Math.random() * this.reelSymbols[reelIndex].length);
                
                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function for realistic deceleration
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    
                    const totalDistance = spins * this.reelSymbols[reelIndex].length + 
                                        (finalPosition - startPosition);
                    const currentPosition = startPosition + totalDistance * easeOut;
                    
                    const displayPosition = currentPosition % this.reelSymbols[reelIndex].length;
                    const translateY = -displayPosition * 40; // 40px per symbol
                    
                    symbolsContainer.style.transform = `translateY(${translateY}px)`;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        this.reelPositions[reelIndex] = finalPosition;
                        callback();
                    }
                };
                
                animate();
            }

            checkWins() {
                const visibleSymbols = this.getVisibleSymbols();
                let totalWin = 0;
                const winLines = [];
                
                // Check each active payline
                for (let line = 0; line < this.activeLines; line++) {
                    const lineSymbols = this.getLineSymbols(visibleSymbols, line);
                    const lineWin = this.calculateLineWin(lineSymbols);
                    
                    if (lineWin > 0) {
                        totalWin += lineWin;
                        winLines.push({ line, win: lineWin, symbols: lineSymbols });
                    }
                }
                
                return { totalWin, winLines };
            }

            getVisibleSymbols() {
                const visible = [];
                for (let reel = 0; reel < 3; reel++) {
                    const reelVisible = [];
                    for (let row = 0; row < 3; row++) {
                        const symbolIndex = (this.reelPositions[reel] + row) % this.reelSymbols[reel].length;
                        reelVisible.push(this.reelSymbols[reel][symbolIndex]);
                    }
                    visible.push(reelVisible);
                }
                return visible;
            }

            getLineSymbols(visibleSymbols, lineIndex) {
                // Line patterns: 0 = middle, 1 = top, 2 = bottom
                const linePatterns = [
                    [1, 1, 1], // Middle line
                    [0, 0, 0], // Top line
                    [2, 2, 2]  // Bottom line
                ];
                
                const pattern = linePatterns[lineIndex];
                return [
                    visibleSymbols[0][pattern[0]],
                    visibleSymbols[1][pattern[1]],
                    visibleSymbols[2][pattern[2]]
                ];
            }

            calculateLineWin(lineSymbols) {
                // Check for three of a kind
                if (lineSymbols[0].symbol === lineSymbols[1].symbol && 
                    lineSymbols[1].symbol === lineSymbols[2].symbol) {
                    return lineSymbols[0].value * this.currentBet * this.multiplier;
                }
                
                // Check for two of a kind (smaller win)
                if (lineSymbols[0].symbol === lineSymbols[1].symbol) {
                    return Math.floor(lineSymbols[0].value * 0.2 * this.currentBet * this.multiplier);
                }
                
                return 0;
            }

            async showWinEffects(winResult) {
                // Show win overlay
                const winOverlay = document.getElementById('winOverlay');
                const winMessage = document.getElementById('winMessage');
                
                winOverlay.classList.add('active');
                winMessage.textContent = `WIN $${winResult.totalWin}!`;
                winMessage.classList.add('show');
                
                // Highlight winning paylines
                const paylines = document.querySelectorAll('.payline');
                winResult.winLines.forEach(winLine => {
                    if (paylines[winLine.line]) {
                        paylines[winLine.line].classList.add('active');
                    }
                });
                
                // Play win sound
                this.playSound('win');
                
                // Create celebration particles
                this.createCelebrationParticles();
                
                // Wait for effects
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Clean up effects
                winOverlay.classList.remove('active');
                winMessage.classList.remove('show');
                paylines.forEach(line => line.classList.remove('active'));
            }

            createCelebrationParticles() {
                const container = document.getElementById('topScreen');
                
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.style.position = 'absolute';
                        particle.style.width = '6px';
                        particle.style.height = '6px';
                        particle.style.background = ['#ffd700', '#ff6b6b', '#74b9ff', '#00cec9'][Math.floor(Math.random() * 4)];
                        particle.style.borderRadius = '50%';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.top = '100%';
                        particle.style.pointerEvents = 'none';
                        particle.style.zIndex = '25';
                        
                        container.appendChild(particle);
                        
                        particle.animate([
                            { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                            { transform: `translateY(-${200 + Math.random() * 200}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                        ], {
                            duration: 2000 + Math.random() * 1000,
                            easing: 'ease-out'
                        }).onfinish = () => particle.remove();
                    }, i * 50);
                }
            }

            playSound(type) {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                switch (type) {
                    case 'spin':
                        oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, this.audioContext.currentTime + 0.5);
                        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                        break;
                    case 'win':
                        oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                        break;
                    case 'beep':
                        oscillator.frequency.setValueAtTime(600, this.audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
                        break;
                }
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.5);
            }

            setControlsEnabled(enabled) {
                const controls = document.querySelectorAll('.control-btn');
                controls.forEach(btn => {
                    if (enabled) {
                        btn.classList.remove('disabled');
                    } else {
                        btn.classList.add('disabled');
                    }
                });
            }

            updateDisplay() {
                document.getElementById('balance').textContent = this.balance;
                document.getElementById('currentBet').textContent = this.currentBet;
                document.getElementById('activeLines').textContent = this.activeLines;
                document.getElementById('multiplier').textContent = this.multiplier + 'x';
                
                // Update last win display
                const lastWinElement = document.getElementById('lastWin');
                if (lastWinElement.textContent !== '0') {
                    setTimeout(() => {
                        lastWinElement.textContent = '0';
                    }, 3000);
                }
            }
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Enable audio context on first user interaction
            document.addEventListener('click', function enableAudio() {
                if (window.game && window.game.audioContext && window.game.audioContext.state === 'suspended') {
                    window.game.audioContext.resume();
                }
                document.removeEventListener('click', enableAudio);
            });
            
            // Start the game
            window.game = new ClaudeSonnetSlots();
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent context menu
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>